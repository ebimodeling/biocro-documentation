<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The BioCro C++ Library: /github/workspace/src/module_library/AuxBioCro.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">The BioCro C++ Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('_aux_bio_cro_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">AuxBioCro.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="_aux_bio_cro_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/* This file will contain functions which are common to several */</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">/* routines in the BioCro package. These are functions needed */</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">/* internally. The normal user will not need them */</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span> </div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="preprocessor">#include &lt;stdexcept&gt;</span>  <span class="comment">// for std::out_of_range, std::range_error</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="preprocessor">#include &lt;algorithm&gt;</span>  <span class="comment">// for std::max, std::min</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="preprocessor">#include &lt;cmath&gt;</span>      <span class="comment">// for exp, log, pow, lgamma</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="preprocessor">#include &quot;<a class="code" href="c4photo_8h.html">c4photo.h</a>&quot;</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#include &quot;<a class="code" href="_bio_cro_8h.html">BioCro.h</a>&quot;</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#include &quot;<a class="code" href="water__and__air__properties_8h.html">water_and_air_properties.h</a>&quot;</span>  <span class="comment">// for saturation_vapor_pressure,</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span>                                       <span class="comment">// TempToDdryA, TempToLHV, TempToSFS</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &quot;<a class="code" href="sun_m_l_8h.html">sunML.h</a>&quot;</span>                     <span class="comment">// for thick_layer_absorption</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &quot;../framework/constants.h&quot;</span>    <span class="comment">// for pi, e, ideal_gas_constant,</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span>                                       <span class="comment">// atmospheric_pressure_at_sea_level,</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span>                                       <span class="comment">// molar_mass_of_water, stefan_boltzmann</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span>                                       <span class="comment">// celsius_to_kelvin</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span> </div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment">// The probability density for the Poisson distribution is</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment">// e^(-lambda) * lambda^x / x!</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="comment">//</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="comment">// Both the numerator lambda^x and denominator x! can become very</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="comment">// large, potentially causing numerical errors when calculating their</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="comment">// ratio.</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="comment">//</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="comment">// In such cases, we take the log of the above expression to get</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="comment">//</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="comment">//   -lambda + (x * log(lambda)) - log(x!).</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="comment">//</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="comment">// We can obtain log(x!) using std::lgamma:</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="comment">//</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="comment">//   lgamma(x + 1) ~= log(x!)</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="comment">//</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="comment">// Then we return the result of applying exp to this.</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="comment">//</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#add002b19ebc8390b467dd10c31bb2cb5">   36</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="_aux_bio_cro_8cpp.html#add002b19ebc8390b467dd10c31bb2cb5">poisson_density</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">double</span> lambda)</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>{</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>    <span class="comment">// Use lgamma to calculate the (log of) the factorial for large</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>    <span class="comment">// values of x:</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>    <span class="keywordflow">if</span> (x &gt; 10) {</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>        <span class="keywordtype">double</span> log_result = -lambda + x * log(lambda) - lgamma(x + 1);</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>        <span class="keywordflow">return</span> exp(log_result);</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>    }</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span> </div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>    <span class="comment">// Do closer to exact calculation for smaller x:</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    <span class="keywordtype">double</span> factorial_x {1};</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= x; ++i) {</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>         factorial_x *= i;</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>    }</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span> </div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>    <span class="keywordflow">return</span> exp(-lambda) * pow(lambda, x) / factorial_x;</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>}</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span> </div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="comment">/* Additional Functions needed for EvapoTrans */</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span> </div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#ad5f0fc680176f312e47c32701ce779f7">   65</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="_aux_bio_cro_8cpp.html#ad5f0fc680176f312e47c32701ce779f7">WINDprof</a>(<span class="keywordtype">double</span> WindSpeed, <span class="keywordtype">double</span> LAI, <span class="keywordtype">int</span> nlayers, <span class="keywordtype">double</span>* wind_speed_profile)</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>{</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>    <span class="keyword">constexpr</span> <span class="keywordtype">double</span> k = 0.7;</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    <span class="keywordtype">double</span> LI = LAI / nlayers;</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span> </div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nlayers; ++i) {</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>        <span class="keywordtype">double</span> CumLAI = LI * (i + 1);</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>        wind_speed_profile[i] = WindSpeed * exp(-k * (CumLAI - LI));</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    }</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>}</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span> </div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#aa4d2cdd07093428af4830f4c8afd660c">  164</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="_aux_bio_cro_8cpp.html#aa4d2cdd07093428af4830f4c8afd660c">RHprof</a>(<span class="keywordtype">double</span> RH, <span class="keywordtype">int</span> nlayers, <span class="keywordtype">double</span>* relative_humidity_profile)</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>{</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    <span class="keywordflow">if</span> (RH &gt; 1 || RH &lt; 0) {</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>        <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;RH must be between 0 and 1.&quot;</span>);</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    }</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    <span class="keywordflow">if</span> (nlayers &lt; 1 || nlayers &gt; <a class="code hl_define" href="_aux_bio_cro_8h.html#a57179778cb6aed95fb9f484b55873d6f">MAXLAY</a>) {</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>        <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;nlayers must be at least 1 but no more than MAXLAY.&quot;</span>);</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    }</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span> </div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> kh = 1 - RH;</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span> </div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nlayers; ++i) {</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>        <span class="keywordtype">double</span> j = i + 1;  <span class="comment">// Explicitly make j a double so that j / nlayers isn&#39;t truncated.</span></div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>        <span class="keywordtype">double</span> temp_rh = RH * exp(kh * (j / nlayers));</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>        relative_humidity_profile[i] = temp_rh;</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    }</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>}</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span> </div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#a2905c23b422ad454d9577841ca594d0d">  182</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="_aux_bio_cro_8cpp.html#a2905c23b422ad454d9577841ca594d0d">LNprof</a>(<span class="keywordtype">double</span> LeafN, <span class="keywordtype">double</span> LAI, <span class="keywordtype">int</span> nlayers, <span class="keywordtype">double</span> kpLN, <span class="keywordtype">double</span>* leafN_profile)</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>{</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    <span class="keywordtype">double</span> LI = LAI / nlayers;</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nlayers; ++i) {</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>        <span class="keywordtype">double</span> CumLAI = LI * (i + 1);</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>        leafN_profile[i] = LeafN * exp(-kpLN * (CumLAI - LI));</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>    }</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>}</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span> </div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#abc33067b20ffdc9e7a47aafe66d7b131">  191</a></span><a class="code hl_struct" href="struct_e_t___str.html">ET_Str</a> <a class="code hl_function" href="_aux_bio_cro_8cpp.html#abc33067b20ffdc9e7a47aafe66d7b131">EvapoTrans2</a>(</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    <span class="keywordtype">double</span> absorbed_shortwave_radiation_et,  <span class="comment">// J / m^2 / s (used to calculate evapotranspiration rate)</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    <span class="keywordtype">double</span> absorbed_shortwave_radiation_lt,  <span class="comment">// J / m^2 / s (used to calculate leaf temperature)</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    <span class="keywordtype">double</span> airTemp,                          <span class="comment">// degrees C</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    <span class="keywordtype">double</span> RH,                               <span class="comment">// dimensionless from Pa / Pa</span></div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    <span class="keywordtype">double</span> WindSpeed,                        <span class="comment">// m / s</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    <span class="keywordtype">double</span> stomatal_conductance,             <span class="comment">// mmol / m^2 / s</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    <span class="keywordtype">double</span> leaf_width,                       <span class="comment">// meter</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    <span class="keywordtype">double</span> specific_heat_of_air,             <span class="comment">// J / kg / K</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>    <span class="keywordtype">double</span> minimum_gbw,                      <span class="comment">// mol / m^2 / s</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    <span class="keywordtype">int</span> eteq                                 <span class="comment">// unitless parameter</span></div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>)</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>{</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> DdryA = <a class="code hl_function" href="water__and__air__properties_8h.html#a6380d8cd4192408df76baefe6b369a70">TempToDdryA</a>(airTemp);               <span class="comment">// kg / m^3. Density of dry air.,</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> LHV = <a class="code hl_function" href="water__and__air__properties_8h.html#a460579178484521ecc50b488c58bb0dd">TempToLHV</a>(airTemp);                   <span class="comment">// J / kg</span></div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> SlopeFS = <a class="code hl_function" href="water__and__air__properties_8h.html#a05f381bbff6170709a8d0e2e34f4556a">TempToSFS</a>(airTemp);               <span class="comment">// kg / m^3 / K</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> SWVP = <a class="code hl_function" href="water__and__air__properties_8h.html#a117fba2c85ba6d52345e7cefc05a43ff">saturation_vapor_pressure</a>(airTemp);  <span class="comment">// Pa.</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span> </div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    <span class="comment">// TODO: This is for about 20 degrees C at 100000 Pa. Change it to use the</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>    <span class="comment">// model state. (1 * R * temperature) / pressure</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    <span class="keywordtype">double</span> <span class="keyword">constexpr</span> volume_of_one_mole_of_air = 24.39e-3;  <span class="comment">// m^3 / mol</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span> </div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    <span class="keywordtype">double</span> minimum_gbw_in_m_per_s = minimum_gbw * volume_of_one_mole_of_air;  <span class="comment">// m / s</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span> </div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    <span class="keywordflow">if</span> (stomatal_conductance &lt;= 0) {</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>        <span class="keywordflow">throw</span> std::range_error(<span class="stringliteral">&quot;Thrown in EvapoTrans2: stomatal conductance is not positive.&quot;</span>);</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>    }</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span> </div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    <span class="keywordtype">double</span> conductance_in_m_per_s = stomatal_conductance * 1e-3 * volume_of_one_mole_of_air;  <span class="comment">// m / s</span></div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span> </div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    <span class="keywordflow">if</span> (RH &gt; 1) {</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>        <span class="keywordflow">throw</span> std::range_error(<span class="stringliteral">&quot;Thrown in EvapoTrans2: RH (relative humidity) is greater than 1.&quot;</span>);</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    }</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    <span class="comment">// Convert from vapor pressure to vapor density using the ideal gas law.</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>    <span class="comment">// This is approximately right for temperatures what won&#39;t kill plants.</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> SWVC =</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>        SWVP / physical_constants::ideal_gas_constant /</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>        (airTemp + conversion_constants::celsius_to_kelvin) * physical_constants::molar_mass_of_water;  <span class="comment">// kg / m^3</span></div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span> </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>    <span class="keywordflow">if</span> (SWVC &lt; 0) {</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>        <span class="keywordflow">throw</span> std::range_error(<span class="stringliteral">&quot;Thrown in EvapoTrans2: SWVC is less than 0.&quot;</span>);</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>    }</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span> </div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> PsycParam = DdryA * specific_heat_of_air / LHV;  <span class="comment">// kg / m^3 / K</span></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span> </div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> vapor_density_deficit = SWVC * (1 - RH);  <span class="comment">// kg / m^3</span></div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span> </div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> ActualVaporPressure = RH * SWVP;  <span class="comment">// Pa</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span> </div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    <span class="comment">/* This is the original from WIMOVAC*/</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    <span class="keywordtype">double</span> Deltat = 0.01;  <span class="comment">// degrees C</span></div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    <span class="keywordtype">double</span> ga;</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>    <span class="keywordtype">double</span> rlc; <span class="comment">/* Long wave radiation for iterative calculation */</span></div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    {</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>        <span class="keywordtype">double</span> ChangeInLeafTemp = 10.0;  <span class="comment">// degrees C</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>        <span class="keywordtype">double</span> Counter = 0;</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>        <span class="keywordflow">do</span> {</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>            ga = <a class="code hl_function" href="_aux_bio_cro_8cpp.html#a7ffa2369991fbb92c2cf4fef41743e49">leaf_boundary_layer_conductance_nikolov</a>(</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>                WindSpeed, leaf_width, airTemp, Deltat, conductance_in_m_per_s,</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>                ActualVaporPressure, minimum_gbw_in_m_per_s);  <span class="comment">// m / s</span></div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>            <span class="comment">/* In WIMOVAC, ga was added to the canopy conductance */</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>            <span class="comment">/* ga = (ga * gbcW)/(ga + gbcW); */</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span> </div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>            <span class="keywordtype">double</span> OldDeltaT = Deltat;</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span> </div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>            rlc = 4 * physical_constants::stefan_boltzmann * pow(conversion_constants::celsius_to_kelvin + airTemp, 3) * Deltat;  <span class="comment">// W / m^2</span></div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span> </div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>            <span class="comment">/* rlc = net long wave radiation emittted per second</span></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span><span class="comment">             *     = radiation emitted per second - radiation absorbed per second</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span><span class="comment">             *     = sigma * (Tair + deltaT)^4 - sigma * Tair^4</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span><span class="comment">             *</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span><span class="comment">             * To make it a linear function of deltaT, do a Taylor series about</span></div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span><span class="comment">             * deltaT = 0 and keep only the zero and first order terms.</span></div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span><span class="comment">             *</span></div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span><span class="comment">             * rlc = sigma * Tair^4 + deltaT * (4 * sigma * Tair^3) - sigma * Tair^4</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span><span class="comment">             *     = 4 * sigma * Tair^3 * deltaT</span></div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span><span class="comment">             *</span></div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span><span class="comment">             * where 4 * sigma * Tair^3 is the derivative of</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span><span class="comment">             * sigma * (Tair + deltaT)^4 evaluated at deltaT = 0</span></div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span><span class="comment">             */</span></div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span> </div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> PhiN2 = absorbed_shortwave_radiation_lt - rlc;  <span class="comment">// W / m^2</span></div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span> </div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>            <span class="comment">/* This equation is from Thornley and Johnson pg. 418 */</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> TopValue = PhiN2 * (1 / ga + 1 / conductance_in_m_per_s) - LHV * vapor_density_deficit;  <span class="comment">// J / m^3</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>            <span class="keyword">const</span> <span class="keywordtype">double</span> BottomValue = LHV * (SlopeFS + PsycParam * (1 + ga / conductance_in_m_per_s));           <span class="comment">// J / m^3 / K</span></div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>            Deltat = fmin(fmax(TopValue / BottomValue, -10), 10);                                                 <span class="comment">// kelvin. Confine Deltat to the interval [-10, 10]:</span></div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span> </div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>            ChangeInLeafTemp = fabs(OldDeltaT - Deltat);  <span class="comment">// kelvin</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>        } <span class="keywordflow">while</span> ((++Counter &lt;= 10) &amp;&amp; (ChangeInLeafTemp &gt; 0.5));</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>    }</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span> </div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>    <span class="comment">/* Net radiation */</span></div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> PhiN = fmax(0, absorbed_shortwave_radiation_et - rlc);  <span class="comment">// W / m^2</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span> </div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>    <span class="comment">// Thornley and Johnson. 1990. Plant and Crop Modeling. Equation 14.4k. Page</span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>    <span class="comment">// 408.</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> penman_monteith =</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>        (SlopeFS * PhiN + LHV * PsycParam * ga * vapor_density_deficit) /</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>        (LHV * (SlopeFS + PsycParam * (1 + ga / conductance_in_m_per_s)));  <span class="comment">// kg / m^2 / s.</span></div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span> </div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> EPen =</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>        (SlopeFS * PhiN + LHV * PsycParam * ga * vapor_density_deficit) /</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>        (LHV * (SlopeFS + PsycParam));  <span class="comment">// kg / m^2 / s</span></div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span> </div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> EPries = 1.26 * SlopeFS * PhiN / (LHV * (SlopeFS + PsycParam));  <span class="comment">// kg / m^2 / s</span></div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span> </div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>    <span class="comment">/* Choose equation to report */</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>    <span class="keywordtype">double</span> TransR;</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>    <span class="keywordflow">switch</span> (eteq) {</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>        <span class="keywordflow">case</span> 1:</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>            TransR = EPen;</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>        <span class="keywordflow">case</span> 2:</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>            TransR = EPries;</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>            TransR = penman_monteith;</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>    }</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span> </div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>    <span class="comment">// TransR has units of kg / m^2 / s. Convert to mmol / m^2 / s using the</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>    <span class="comment">// molar mass of water (in kg / mol) and noting that 1e3 mmol = 1 mol</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>    <span class="keywordtype">double</span> cf = 1e3 / physical_constants::molar_mass_of_water;  <span class="comment">// mmol / kg for water</span></div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span> </div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>    <a class="code hl_struct" href="struct_e_t___str.html">ET_Str</a> et_results;</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>    et_results.<a class="code hl_variable" href="struct_e_t___str.html#a53d1afc42e3609e6eb8145169c7b5aaf">TransR</a> = TransR * cf;                                         <span class="comment">// mmol / m^2 / s</span></div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>    et_results.<a class="code hl_variable" href="struct_e_t___str.html#a7ee08add5c06f347e177447a6516ca01">EPenman</a> = EPen * cf;                                          <span class="comment">// mmol / m^2 / s</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>    et_results.<a class="code hl_variable" href="struct_e_t___str.html#a45c6793a51f491bf058f154777e48ec9">EPriestly</a> = EPries * cf;                                      <span class="comment">// mmol / m^2 / s</span></div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>    et_results.<a class="code hl_variable" href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">Deltat</a> = Deltat;                                              <span class="comment">// degrees C</span></div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>    et_results.<a class="code hl_variable" href="struct_e_t___str.html#a488dc75fbd1ec09aba81e6016377c7f0">boundary_layer_conductance</a> = ga / volume_of_one_mole_of_air;  <span class="comment">// mol / m^2 / s</span></div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span> </div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    <span class="keywordflow">return</span> et_results;</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>}</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span> </div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#a7ffa2369991fbb92c2cf4fef41743e49">  383</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="_aux_bio_cro_8cpp.html#a7ffa2369991fbb92c2cf4fef41743e49">leaf_boundary_layer_conductance_nikolov</a>(</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>    <span class="keywordtype">double</span> windspeed,             <span class="comment">// m / s</span></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    <span class="keywordtype">double</span> leafwidth,             <span class="comment">// m</span></div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>    <span class="keywordtype">double</span> air_temperature,       <span class="comment">// degrees C</span></div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>    <span class="keywordtype">double</span> delta_t,               <span class="comment">// degrees C</span></div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    <span class="keywordtype">double</span> stomcond,              <span class="comment">// m / s</span></div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    <span class="keywordtype">double</span> water_vapor_pressure,  <span class="comment">// Pa</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    <span class="keywordtype">double</span> minimum_gbw            <span class="comment">// m / s</span></div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>)</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>{</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>    <span class="keyword">constexpr</span> <span class="keywordtype">double</span> p = physical_constants::atmospheric_pressure_at_sea_level;  <span class="comment">// Pa</span></div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span> </div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    <span class="keywordtype">double</span> leaftemp = air_temperature + delta_t;                             <span class="comment">// degrees C</span></div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    <span class="keywordtype">double</span> gsv = stomcond;                                                   <span class="comment">// m / s</span></div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>    <span class="keywordtype">double</span> Tak = air_temperature + conversion_constants::celsius_to_kelvin;  <span class="comment">// K</span></div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>    <span class="keywordtype">double</span> Tlk = leaftemp + conversion_constants::celsius_to_kelvin;         <span class="comment">// K</span></div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>    <span class="keywordtype">double</span> ea = water_vapor_pressure;                                        <span class="comment">// Pa</span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>    <span class="keywordtype">double</span> lw = leafwidth;                                                   <span class="comment">// m</span></div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span> </div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>    <span class="keywordtype">double</span> esTl = <a class="code hl_function" href="water__and__air__properties_8h.html#a117fba2c85ba6d52345e7cefc05a43ff">saturation_vapor_pressure</a>(leaftemp);  <span class="comment">// Pa.</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span> </div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>    <span class="comment">// Forced convection</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    <span class="keyword">constexpr</span> <span class="keywordtype">double</span> cf = 1.6361e-3;  <span class="comment">// TODO: Nikolov et. al equation 29 use cf = 4.322e-3, not cf = 1.6e-3 as is used here.</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span> </div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    <span class="keywordtype">double</span> gbv_forced = cf * pow(Tak, 0.56) * pow((Tak + 120) * ((windspeed / lw) / p), 0.5);  <span class="comment">// m / s.</span></div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span> </div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>    <span class="comment">// Free convection</span></div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    <span class="keywordtype">double</span> gbv_free = gbv_forced;</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>    <span class="keywordtype">double</span> eb = (gsv * esTl + gbv_free * ea) / (gsv + gbv_free);  <span class="comment">// Pa. Eq 35</span></div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span> </div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>    <span class="keywordtype">double</span> Tvdiff = (Tlk / (1 - 0.378 * eb / p)) - (Tak / (1 - 0.378 * ea / p));  <span class="comment">// kelvin. It is also degrees C since it is a temperature difference. Eq. 34</span></div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span> </div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>    <span class="keywordflow">if</span> (Tvdiff &lt; 0) Tvdiff = -Tvdiff;</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span> </div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>    gbv_free = cf * pow(Tlk, 0.56) * pow((Tlk + 120) / p, 0.5) * pow(Tvdiff / lw, 0.25);  <span class="comment">// m / s. Eq. 33</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span> </div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>    <span class="comment">// Overall conductance</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>    <span class="keywordtype">double</span> gbv = std::max(gbv_forced, gbv_free);  <span class="comment">// m / s</span></div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span> </div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>    <span class="comment">// Apply the minimum</span></div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>    <span class="keywordflow">return</span> std::max(gbv, minimum_gbw);  <span class="comment">// m / s</span></div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>}</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span> </div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#a33949e3620b40eedec427390bde216f0">  481</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="_aux_bio_cro_8cpp.html#a33949e3620b40eedec427390bde216f0">leaf_boundary_layer_conductance_thornley</a>(</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>    <span class="keywordtype">double</span> CanopyHeight,    <span class="comment">// m</span></div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>    <span class="keywordtype">double</span> WindSpeed,       <span class="comment">// m / s</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>    <span class="keywordtype">double</span> minimum_gbw,     <span class="comment">// m / s</span></div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>    <span class="keywordtype">double</span> WindSpeedHeight  <span class="comment">// m</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>)</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>{</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>    <span class="comment">// Define constants used in the model</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>    <span class="keyword">constexpr</span> <span class="keywordtype">double</span> kappa = 0.41;      <span class="comment">// dimensionless. von Karmon&#39;s constant. Thornley and Johnson pgs 414 and 416.</span></div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>    <span class="keyword">constexpr</span> <span class="keywordtype">double</span> ZetaCoef = 0.026;  <span class="comment">// dimensionless, Thornley and Johnson 1990, Eq. 14.9o</span></div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>    <span class="keyword">constexpr</span> <span class="keywordtype">double</span> ZetaMCoef = 0.13;  <span class="comment">// dimensionless, Thornley and Johnson 1990, Eq. 14.9o</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>    <span class="keyword">constexpr</span> <span class="keywordtype">double</span> dCoef = 0.77;      <span class="comment">// dimensionless, Thornley and Johnson 1990, Eq. 14.9o.</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>                                        <span class="comment">// In the original text this value is reported as 0.64.</span></div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>                                        <span class="comment">// In the 2000 reprinting of this text, the authors state that this value should be 0.77.</span></div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>                                        <span class="comment">// See &quot;Errata to the 2000 printing&quot; on the page after the preface of the 2000 reprinting of the 1990 text.</span></div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span> </div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>    <span class="comment">// Apply the height limit</span></div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>    CanopyHeight = std::min(CanopyHeight, 0.98 * WindSpeedHeight);  <span class="comment">// meters</span></div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span> </div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>    <span class="comment">// Calculate terms that depend on the canopy height</span></div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> Zeta = ZetaCoef * CanopyHeight;    <span class="comment">// meters</span></div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> Zetam = ZetaMCoef * CanopyHeight;  <span class="comment">// meters</span></div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> d = dCoef * CanopyHeight;          <span class="comment">// meters</span></div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span> </div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>    <span class="comment">// Calculate the boundary layer conductance `ga` according to Thornley and</span></div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>    <span class="comment">// Johnson Eq. 14.9n, pg. 416</span></div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> ga0 = pow(kappa, 2) * WindSpeed;                   <span class="comment">// m / s</span></div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> ga1 = log((WindSpeedHeight + Zeta - d) / Zeta);    <span class="comment">// dimensionless</span></div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> ga2 = log((WindSpeedHeight + Zetam - d) / Zetam);  <span class="comment">// dimensionless</span></div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> gbv = ga0 / (ga1 * ga2);                           <span class="comment">// m / s</span></div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span> </div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>    <span class="comment">// Apply the minimum</span></div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>    <span class="keywordflow">return</span> std::max(gbv, minimum_gbw);  <span class="comment">// m / s</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>}</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span> </div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span><span class="comment">/* Soil Evaporation Function */</span></div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span><span class="comment">/* Variables I need */</span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span><span class="comment">/* LAI = Leaf Area Index */</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span><span class="comment">/* k = extinction coefficient */</span></div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span><span class="comment">/* ppfd = Photosynthetic photon flux density */</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span><span class="comment">/* awc, wiltp, fieldc = available water content, wilting point and field capacity */</span></div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span><span class="comment">/* winds = wind speed */</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span> </div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#ab163aedfdfb73c66e5eb8dca307016be">  524</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="_aux_bio_cro_8cpp.html#ab163aedfdfb73c66e5eb8dca307016be">SoilEvapo</a>(</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>    <span class="keywordtype">double</span> LAI,</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>    <span class="keywordtype">double</span> k,</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>    <span class="keywordtype">double</span> air_temperature,</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>    <span class="keywordtype">double</span> ppfd,</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>    <span class="keywordtype">double</span> soil_water_content,</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>    <span class="keywordtype">double</span> fieldc,</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>    <span class="keywordtype">double</span> wiltp,</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>    <span class="keywordtype">double</span> winds,</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>    <span class="keywordtype">double</span> RelH,</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>    <span class="keywordtype">double</span> rsec,</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>    <span class="keywordtype">double</span> soil_clod_size,</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>    <span class="keywordtype">double</span> soil_reflectance,</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>    <span class="keywordtype">double</span> soil_transmission,</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>    <span class="keywordtype">double</span> specific_heat_of_air,</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>    <span class="keywordtype">double</span> par_energy_content)</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>{</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>    <span class="keywordtype">int</span> method = 1;</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span> </div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>    <span class="comment">// A simple way of calculating the proportion of the soil that is hit by</span></div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>    <span class="comment">// direct radiation.</span></div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>    <span class="keywordtype">double</span> soil_area_sunlit_fraction = exp(-k * LAI);  <span class="comment">// dimensionless.</span></div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span> </div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>    <span class="comment">// For now the temperature of the soil will be the same as the air. At a</span></div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>    <span class="comment">// later time this can be made more accurate. I looked at the equations for</span></div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>    <span class="comment">// this and the issue is that it is strongly dependent on depth. Since the</span></div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>    <span class="comment">// soil model now has a single layer, this cannot be implemented correctly</span></div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>    <span class="comment">// at the moment.</span></div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>    <span class="keywordtype">double</span> SoilTemp = air_temperature;</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span> </div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>    <span class="comment">/* From Campbell and Norman. Environmental Biophysics. */</span></div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>    <span class="comment">/* If relative available water content is */</span></div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>    <span class="keywordtype">double</span> rawc = (soil_water_content - wiltp) / (fieldc - wiltp);  <span class="comment">// dimensionless. relative available water content.</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span> </div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>    <span class="comment">/* Campbell and Norman. Environmental Physics, page 142 */</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>    <span class="keywordtype">double</span> maximum_uptake_rate = 1 - pow((1 + 1.3 * rawc), -5);  <span class="comment">// dimensionless</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>    <span class="comment">/* This is a useful idea because dry soils evaporate little water when dry*/</span></div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span> </div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>    <span class="comment">// Total Radiation: At the moment soil evaporation is grossly overestimated.</span></div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>    <span class="comment">// In WIMOVAC the light reaching the last layer of leaves is used. Here</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>    <span class="comment">// instead of calculating this again, I will for now assume a 10% as a rough</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>    <span class="comment">// estimate. Note that I could maybe get this since layIdir and layIDiff in</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>    <span class="comment">// sunML are external variables.  Rprintf(&quot;ppfd %.5f&quot;,layIdir[0],&quot;\n&quot;);</span></div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>    <span class="comment">// Update: 03-13-2009. I tried printing this value but it is still too high</span></div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>    <span class="comment">// and will likely overestimate soil evaporation. However, this is still a</span></div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>    <span class="comment">// work in progress.</span></div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>    ppfd *= rsec; <span class="comment">/* Radiation soil evaporation coefficient */</span></div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span> </div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>    <span class="keywordtype">double</span> TotalRadiation = ppfd * par_energy_content;</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span> </div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>    <span class="keywordtype">double</span> DdryA = <a class="code hl_function" href="water__and__air__properties_8h.html#a6380d8cd4192408df76baefe6b369a70">TempToDdryA</a>(air_temperature);</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>    <span class="keywordtype">double</span> LHV = <a class="code hl_function" href="water__and__air__properties_8h.html#a460579178484521ecc50b488c58bb0dd">TempToLHV</a>(air_temperature);  <span class="comment">// J / kg</span></div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>    <span class="keywordtype">double</span> SlopeFS = <a class="code hl_function" href="water__and__air__properties_8h.html#a05f381bbff6170709a8d0e2e34f4556a">TempToSFS</a>(air_temperature);</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>    <span class="keywordtype">double</span> SWVC = <a class="code hl_function" href="water__and__air__properties_8h.html#a117fba2c85ba6d52345e7cefc05a43ff">saturation_vapor_pressure</a>(air_temperature) * 1e-5;</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span> </div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>    <span class="keywordtype">double</span> PsycParam = (DdryA * specific_heat_of_air) / LHV;</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>    <span class="keywordtype">double</span> vapor_density_deficit = SWVC * (1 - RelH / 100);</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span> </div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>    <span class="keywordtype">double</span> BoundaryLayerThickness = 4e-3 * sqrt(soil_clod_size / winds);</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>    <span class="keywordtype">double</span> DiffCoef = 2.126e-5 + 1.48e-7 * SoilTemp;</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>    <span class="keywordtype">double</span> SoilBoundaryLayer = DiffCoef / BoundaryLayerThickness;</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span> </div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>    <span class="comment">// Here we calculate the total amount of PAR energy absorbed by the soil</span></div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>    <span class="comment">// using `thick_layer_absorption`. We assume half of the solar energy lies</span></div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>    <span class="comment">// in the PAR band, so we multiply by 2 to get the total absorbed solar</span></div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>    <span class="comment">// energy. This is almost certainly untrue for light that has passed through</span></div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>    <span class="comment">// a plant canopy.</span></div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>    <span class="keywordtype">double</span> Ja = 2 * <a class="code hl_function" href="sun_m_l_8cpp.html#ab491bb8553ee710f275dbcd2b3e4547b">thick_layer_absorption</a>(</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>                        soil_reflectance,</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>                        soil_transmission,</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>                        TotalRadiation);</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span> </div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>    <span class="keywordtype">double</span> rlc = 4 * physical_constants::stefan_boltzmann * pow((conversion_constants::celsius_to_kelvin + SoilTemp), 3) * 0.005;</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>    <span class="comment">// The last term should be the difference between air temperature and soil.</span></div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>    <span class="comment">// This is not actually calculated at the moment. Since this is mostly</span></div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>    <span class="comment">// relevant to the first soil layer where the temperatures are similar. I</span></div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>    <span class="comment">// will leave it like this for now.</span></div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span> </div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>    <span class="keywordtype">double</span> PhiN = Ja - rlc; <span class="comment">/* Calculate the net radiation balance*/</span></div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>    <span class="keywordflow">if</span> (PhiN &lt; 0) PhiN = 1e-7;</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span> </div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>    <span class="keywordtype">double</span> Evaporation = 0.0;</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>    <span class="keywordflow">if</span> (method == 0) {</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>        <span class="comment">/* Priestly-Taylor */</span></div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>        Evaporation = 1.26 * (SlopeFS * PhiN) / (LHV * (SlopeFS + PsycParam));  <span class="comment">// kg / m^2 / s.</span></div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>        <span class="comment">/* Penman-Monteith */</span></div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>        Evaporation = (SlopeFS * PhiN + LHV * PsycParam * SoilBoundaryLayer * vapor_density_deficit) / (LHV * (SlopeFS + PsycParam));  <span class="comment">// kg / m^2 / s.</span></div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>    }</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span> </div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>    Evaporation *= soil_area_sunlit_fraction * maximum_uptake_rate;  <span class="comment">// kg / m^2 / s.</span></div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>    <span class="keywordflow">if</span> (Evaporation &lt; 0) Evaporation = 1e-6;                         <span class="comment">// Prevent odd values at very low light levels.</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span> </div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>    <span class="keywordflow">return</span> Evaporation;  <span class="comment">// kg / m^2 / s.</span></div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>}</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span> </div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#a058be0e6ed718b377d7c6056cceb09a8">  620</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="_aux_bio_cro_8cpp.html#a058be0e6ed718b377d7c6056cceb09a8">compute_wsPhoto</a>(<span class="keywordtype">int</span> wsFun, <span class="keywordtype">double</span> fieldc, <span class="keywordtype">double</span> wiltp, <span class="keywordtype">double</span> phi1, <span class="keywordtype">double</span> awc)</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>{</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>    <span class="comment">// Three different type of equations for modeling the effect of</span></div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>    <span class="comment">// water stress on vmax and leaf area expansion.  The equation for</span></div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>    <span class="comment">// leaf area expansion is more severe than the one for vmax. */</span></div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>    <span class="keywordtype">double</span> wsPhoto;</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>    <span class="keywordflow">switch</span> (wsFun) {</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>        <span class="keywordflow">case</span> 0: { <span class="comment">/* linear */</span></div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>            <span class="keywordtype">double</span> slp = 1 / (fieldc - wiltp);</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>            <span class="keywordtype">double</span> intcpt = 1 - fieldc * slp;</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>            wsPhoto = slp * awc + intcpt;</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>        }</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>        <span class="keywordflow">case</span> 1: {</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>            <span class="keywordtype">double</span> phi10 = (fieldc + wiltp) / 2;</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>            wsPhoto = 1 / (1 + exp((phi10 - awc) / phi1));</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>        }</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>        <span class="keywordflow">case</span> 2: {</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>            <span class="keywordtype">double</span> slp = (1 - wiltp) / (fieldc - wiltp);</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>            <span class="keywordtype">double</span> intcpt = 1 - fieldc * slp;</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>            <span class="keywordtype">double</span> theta = slp * awc + intcpt;</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>            wsPhoto = (1 - exp(-2.5 * (theta - wiltp) / (1 - wiltp))) / (1 - exp(-2.5));</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>        }</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>        <span class="keywordflow">case</span> 3:</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>            wsPhoto = 1;</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>            wsPhoto = 0;</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>    }</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span> </div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>    <span class="comment">// wsPhoto can be mathematically lower than zero in some cases but</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>    <span class="comment">// I should prevent that:</span></div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>    <span class="keywordflow">if</span> (wsPhoto &lt;= 0) {</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>        wsPhoto = 1e-10;</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>    }</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span> </div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>    <span class="comment">// Apparently wsPhoto can be greater than 1.</span></div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>    <span class="keywordflow">if</span> (wsPhoto &gt; 1) wsPhoto = 1;</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span> </div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>    <span class="keywordflow">return</span> wsPhoto;</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>}</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span> </div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span><span class="comment">/* This is a new function that attempts to keep a water budget and then</span></div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span><span class="comment">   calcualte an empirical coefficient that reduces the specific leaf area.</span></div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span><span class="comment">   This results from the general idea that water stress reduces first the</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span><span class="comment">   rate of leaf expansion. */</span></div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span> </div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span><span class="comment">/* This is meant to be a simple function that calculates a</span></div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span><span class="comment">   simple empirical coefficient that reduces specifi leaf area</span></div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span><span class="comment">   according to the water stress of the plant. This is done</span></div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span><span class="comment">   for now, with a very simple empirical approach. */</span></div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span> </div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#afd82d6a23b65b58f4b7652dc9c8146c3">  674</a></span><a class="code hl_struct" href="structws__str.html">ws_str</a> <a class="code hl_function" href="_aux_bio_cro_8cpp.html#afd82d6a23b65b58f4b7652dc9c8146c3">watstr</a>(</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>    <span class="keywordtype">double</span> precipit,</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>    <span class="keywordtype">double</span> evapo,</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>    <span class="keywordtype">double</span> cws,</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>    <span class="keywordtype">double</span> soildepth,</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>    <span class="keywordtype">double</span> fieldc,</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>    <span class="keywordtype">double</span> wiltp,</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>    <span class="keywordtype">double</span> soil_saturation_capacity,</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>    <span class="keywordtype">double</span> sand,</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>    <span class="keywordtype">double</span> Ks,</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>    <span class="keywordtype">double</span> air_entry,</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>    <span class="keywordtype">double</span> b)</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>{</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>    <span class="keyword">constexpr</span> <span class="keywordtype">double</span> g = 9.8;  <span class="comment">// m / s^2  ##  http://en.wikipedia.org/wiki/Standard_gravity</span></div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span> </div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>    <span class="keywordtype">double</span> precipM = precipit * 1e-3;                        <span class="comment">/* convert precip in mm to m*/</span></div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>    <span class="keywordtype">double</span> soil_water_fraction = precipM / soildepth + cws;  <span class="comment">// m^3 m^-3</span></div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span> </div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>    <span class="keywordtype">double</span> runoff = 0.0;</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>    <span class="keywordtype">double</span> Nleach = 0.0; <span class="comment">/* Nleach is the NO3 leached. */</span></div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span> </div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>    <span class="keywordflow">if</span> (soil_water_fraction &gt; soil_saturation_capacity) {</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>        runoff = (soil_water_fraction - soil_saturation_capacity) * soildepth; <span class="comment">/* This is in meters */</span></div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>        <span class="comment">/* Here runoff is interpreted as water content exceeding saturation level */</span></div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>        <span class="comment">/* Need to convert to units used in the Parton et al 1988 paper. */</span></div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>        <span class="comment">/* The data come in mm/hr and need to be in cm/month */</span></div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>        Nleach = runoff / (1e3 * physical_constants::molar_mass_of_water) * (0.2 + 0.7 * sand);</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>        soil_water_fraction = soil_saturation_capacity;</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>    }</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span> </div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>    <span class="comment">/* The density of water is 0.9982 Mg / m^3 at 20 degrees Celsius. */</span></div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>    <span class="comment">/* evapo is demanded water (Mg / ha) */</span></div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>    <span class="keywordtype">double</span> npaw = soil_water_fraction - wiltp - evapo / 0.9982 / 1e4 / soildepth;  <span class="comment">// fraction of saturation.</span></div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span> </div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>    <span class="comment">/* If demand exceeds supply, the crop is getting close to wilting point and transpiration</span></div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span><span class="comment">       will be over estimated. In this one layer model though, the crop is practically dead. */</span></div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>    <span class="keywordflow">if</span> (npaw &lt; 0) npaw = 0.0;</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>    <span class="keywordtype">double</span> awc = npaw + wiltp;</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span> </div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>    <span class="comment">/* Calculating the soil water potential based on equations from Norman and Campbell */</span></div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>    <span class="comment">/* tmp.psim = soTexS.air_entry * pow((awc/soTexS.fieldc*1.1),-soTexS.b); */</span></div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>    <span class="comment">/* New version of the soil water potential is based on</span></div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span><span class="comment">     * &quot;Dynamic Simulation of Water Deficit Effects upon Maize Yield&quot; R. F. Grant Agricultural Systems. 33(1990) 13-39. */</span></div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>    <a class="code hl_struct" href="structws__str.html">ws_str</a> tmp;</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>    tmp.<a class="code hl_variable" href="structws__str.html#ac2f458ad74016a5af57f18d9774bb0d9">psim</a> = -exp(log(0.033) + (log(fieldc) - log(awc)) / (log(fieldc) - log(wiltp)) * (log(1.5) - log(0.033))) * 1e3; <span class="comment">/* This last term converts from MPa to kPa */</span></div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span> </div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>    <span class="comment">/* This is drainage */</span></div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>    <span class="keywordflow">if</span> (awc &gt; fieldc) {</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>        <span class="keywordtype">double</span> K_psim = Ks * pow((air_entry / tmp.<a class="code hl_variable" href="structws__str.html#ac2f458ad74016a5af57f18d9774bb0d9">psim</a>), 2 + 3 / b); <span class="comment">/* This is hydraulic conductivity */</span></div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span> </div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>        <span class="comment">// Campbell, pg 129 do not ignore the graviational effect. I multiply</span></div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>        <span class="comment">// soil depth by 0.5 to calculate the average depth.</span></div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>        <span class="keywordtype">double</span> J_w = -K_psim * (-tmp.<a class="code hl_variable" href="structws__str.html#ac2f458ad74016a5af57f18d9774bb0d9">psim</a> / (soildepth * 0.5)) - g * K_psim;</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span> </div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>        <span class="keywordtype">double</span> drainage = J_w * 3600 * 0.9982 * 1e-3; <span class="comment">/* This is flow in m^3 / (m^2 * hr). */</span></div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>        awc = awc + drainage / soildepth;</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>    }</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span> </div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>    tmp.<a class="code hl_variable" href="structws__str.html#aa293628634276d793267cbf2542ce2e2">awc</a> = awc;</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>    tmp.<a class="code hl_variable" href="structws__str.html#a365dc60f2331a4280fc2be55b822191c">runoff</a> = runoff;</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>    tmp.<a class="code hl_variable" href="structws__str.html#a26953bee326ec08f079e24838fc8feb6">Nleach</a> = Nleach;</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>    <span class="keywordflow">return</span> tmp;</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>}</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span> </div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span><span class="comment">/* Function to simulate the multilayer behavior of soil water. In the</span></div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span><span class="comment">   future this could be coupled with Campbell (BASIC) ideas to</span></div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span><span class="comment">   esitmate water potential. */</span></div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#a7f7b8457e2206d31608f20cc696341b7">  741</a></span><a class="code hl_struct" href="structsoil_m_l__str.html">soilML_str</a> <a class="code hl_function" href="_aux_bio_cro_8cpp.html#a7f7b8457e2206d31608f20cc696341b7">soilML</a>(</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>    <span class="keywordtype">double</span> precipit,</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>    <span class="keywordtype">double</span> transp,</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>    <span class="keywordtype">double</span>* cws,</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>    <span class="keywordtype">double</span> soildepth,</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>    <span class="keywordtype">double</span>* depths,</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>    <span class="keywordtype">double</span> soil_field_capacity,</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>    <span class="keywordtype">double</span> soil_wilting_point,</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>    <span class="keywordtype">double</span> soil_saturation_capacity,</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>    <span class="keywordtype">double</span> soil_air_entry,</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>    <span class="keywordtype">double</span> soil_saturated_conductivity,</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>    <span class="keywordtype">double</span> soil_b_coefficient,</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>    <span class="keywordtype">double</span> soil_sand_content,</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>    <span class="keywordtype">double</span> phi1,</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>    <span class="keywordtype">double</span> phi2,</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>    <span class="keywordtype">int</span> wsFun,</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>    <span class="keywordtype">int</span> layers,</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>    <span class="keywordtype">double</span> rootDB,</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>    <span class="keywordtype">double</span> LAI,</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>    <span class="keywordtype">double</span> k,</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>    <span class="keywordtype">double</span> AirTemp,</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>    <span class="keywordtype">double</span> IRad,</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>    <span class="keywordtype">double</span> winds,</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>    <span class="keywordtype">double</span> RelH,</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>    <span class="keywordtype">int</span> hydrDist,</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>    <span class="keywordtype">double</span> rfl,</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>    <span class="keywordtype">double</span> rsec,</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>    <span class="keywordtype">double</span> rsdf,</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>    <span class="keywordtype">double</span> soil_clod_size,</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>    <span class="keywordtype">double</span> soil_reflectance,</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>    <span class="keywordtype">double</span> soil_transmission,</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>    <span class="keywordtype">double</span> specific_heat_of_air,</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>    <span class="keywordtype">double</span> par_energy_content)</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>{</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>    <span class="keyword">constexpr</span> <span class="keywordtype">double</span> g = 9.8; <span class="comment">/* m / s-2  ##  http://en.wikipedia.org/wiki/Standard_gravity */</span></div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span> </div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>    <a class="code hl_struct" href="structsoil_m_l__str.html">soilML_str</a> return_value;</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span> </div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>    <span class="comment">/* Crude empirical relationship between root biomass and rooting depth*/</span></div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>    <span class="keywordtype">double</span> rootDepth = fmin(rootDB * rsdf, soildepth);</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span> </div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>    <a class="code hl_struct" href="structrd__str.html">rd_str</a> root_distribution = <a class="code hl_function" href="_aux_bio_cro_8cpp.html#afc92a0998ee191ec72b256ad232804c9">rootDist</a>(layers, rootDepth, &amp;depths[0], rfl);</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span> </div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>    <span class="comment">/* unit conversion for precip */</span></div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>    <span class="keywordtype">double</span> oldWaterIn = 0.0;</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>    <span class="keywordtype">double</span> waterIn = precipit * 1e-3; <span class="comment">/* convert precip in mm to m */</span></div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span> </div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>    <span class="keywordtype">double</span> drainage = 0.0;</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>    <span class="keywordtype">double</span> wsPhotoCol = 0.0;</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>    <span class="keywordtype">double</span> LeafWSCol = 0.0;</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>    <span class="keywordtype">double</span> Sevap = 0.0;</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>    <span class="keywordtype">double</span> oldEvapoTra = 0.0;</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span> </div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>    <span class="comment">// The counter, i, decreases because I increase the water content due to</span></div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>    <span class="comment">// precipitation in the last layer first</span></div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = layers - 1; i &gt;= 0; --i) {</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>        <span class="keywordtype">double</span> layerDepth = depths[i + 1] - depths[i]; <span class="comment">/* This supports unequal depths. */</span></div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span> </div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>        <span class="keywordflow">if</span> (hydrDist &gt; 0) {</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>            <span class="comment">/* For this section see Campbell and Norman &quot;Environmental BioPhysics&quot; Chapter 9*/</span></div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>            <span class="comment">/* First compute the matric potential */</span></div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>            <span class="keywordtype">double</span> psim1 = soil_air_entry * pow((cws[i] / soil_saturation_capacity), -soil_b_coefficient); <span class="comment">/* This is matric potential of current layer */</span></div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>            <span class="keywordtype">double</span> dPsim;</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>            <span class="keywordflow">if</span> (i &gt; 0) {</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>                <span class="keywordtype">double</span> psim2 = soil_air_entry * pow((cws[i - 1] / soil_saturation_capacity), -soil_b_coefficient); <span class="comment">/* This is matric potential of next layer */</span></div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>                dPsim = psim1 - psim2;</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>                <span class="comment">// The substraction is from the layer i - (i-1). If this last</span></div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>                <span class="comment">// term is positive then it will move upwards. If it is negative</span></div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>                <span class="comment">// it will move downwards. Presumably this term is almost always</span></div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>                <span class="comment">// positive.</span></div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>                dPsim = 0.0;</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>            }</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span> </div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>            <span class="keywordtype">double</span> K_psim = soil_saturated_conductivity * pow((soil_air_entry / psim1), 2 + 3 / soil_b_coefficient); <span class="comment">/* This is hydraulic conductivity */</span></div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>            <span class="keywordtype">double</span> J_w = K_psim * (dPsim / layerDepth) - g * K_psim;                                                 <span class="comment">/*  Campbell, pg 129 do not ignore the graviational effect*/</span></div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>            <span class="comment">/* Notice that K_psim is positive because my reference system is reversed */</span></div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>            <span class="comment">/* This last result should be in kg/(m2 * s) */</span></div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>            J_w *= 3600 * 0.9882 * 1e-3; <span class="comment">/* This is flow in m3 / (m^2 * hr). */</span></div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span> </div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>            <span class="keywordflow">if</span> (i == (layers - 1) &amp;&amp; J_w &lt; 0) {</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>                <span class="comment">/* cws[i] = cws[i] + J_w / layerDepth; Although this should be done it drains the last layer too much.*/</span></div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>                drainage += J_w;</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>                cws[i] = cws[i] - J_w / layerDepth;</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>                <span class="keywordflow">if</span> (i &gt; 0) {</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>                    cws[i - 1] = cws[i - 1] + J_w / layerDepth;</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>                }</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>            }</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>        }</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span> </div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>        <span class="keywordflow">if</span> (cws[i] &gt; soil_saturation_capacity) cws[i] = soil_saturation_capacity;</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>        <span class="keywordflow">if</span> (cws[i] &lt; soil_wilting_point) cws[i] = soil_wilting_point;</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>        <span class="comment">// Here is a convention aw is available water in volume and awc</span></div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>        <span class="comment">// is available water content as a fraction of the soil section being investigated.</span></div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>        <span class="keywordtype">double</span> aw = cws[i] * layerDepth;</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>        <span class="comment">/* Available water (for this layer) is the current water status times the layer depth */</span></div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span> </div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>        <span class="keywordflow">if</span> (waterIn &gt; 0) {</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>            <span class="comment">/* There is some rain. Need to add it.*/</span></div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>            aw += waterIn / layers + oldWaterIn; <span class="comment">/* They are both in meters so it works */</span></div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>            <span class="comment">/* Adding the same amount to water to each layer */</span></div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>            <span class="comment">/* In case there is overflow */</span></div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>            <span class="keywordtype">double</span> diffw = soil_field_capacity * layerDepth - aw;</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span> </div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>            <span class="keywordflow">if</span> (diffw &lt; 0) {</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>                <span class="comment">/* This means that precipitation exceeded the capacity of the first layer */</span></div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>                <span class="comment">/* Save this amount of water for the next layer */</span></div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>                oldWaterIn = -diffw;</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>                aw = soil_field_capacity * layerDepth;</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>                oldWaterIn = 0.0;</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>            }</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>        }</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span> </div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>        <span class="comment">/* Root Biomass */</span></div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>        <span class="keywordtype">double</span> rootATdepth = rootDB * root_distribution.<a class="code hl_variable" href="structrd__str.html#ab5c89562271d3c87e310c002806858ae">rootDist</a>[i];</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>        return_value.<a class="code hl_variable" href="structsoil_m_l__str.html#ab5c89562271d3c87e310c002806858ae">rootDist</a>[i] = rootATdepth;</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>        <span class="comment">/* Plant available water is only between current water status and permanent wilting point */</span></div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>        <span class="comment">/* Plant available water */</span></div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>        <span class="keywordtype">double</span> pawha = (aw - soil_wilting_point * layerDepth) * 1e4;</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span> </div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>        <span class="keywordflow">if</span> (pawha &lt; 0) pawha = 0;</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span> </div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>        <span class="keywordtype">double</span> Ctransp = 0.0;</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>        <span class="keywordtype">double</span> EvapoTra = 0.0;</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>        <span class="keywordtype">double</span> Newpawha;</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span> </div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>        <span class="keywordflow">if</span> (i == 0) {</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>            <span class="comment">/* Only the first layer is affected by soil evaporation */</span></div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>            <span class="keywordtype">double</span> awc2 = aw / layerDepth;</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>            <span class="comment">/* SoilEvapo function needs soil water content  */</span></div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>            Sevap = <a class="code hl_function" href="_aux_bio_cro_8cpp.html#ab163aedfdfb73c66e5eb8dca307016be">SoilEvapo</a>(</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>                        LAI, k, AirTemp, IRad, awc2, soil_field_capacity,</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>                        soil_wilting_point, winds, RelH, rsec, soil_clod_size,</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>                        soil_reflectance, soil_transmission, specific_heat_of_air,</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>                        par_energy_content) *</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>                    3600 * 1e-3 * 10000;  <span class="comment">// Mg / ha / hr. 3600 s / hr * 1e-3 Mg / kg * 10000 m^2 / ha.</span></div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>            <span class="comment">/* I assume that crop transpiration is distributed simlarly to</span></div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span><span class="comment">               root density.  In other words the crop takes up water proportionally</span></div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span><span class="comment">               to the amount of root in each respective layer.*/</span></div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>            Ctransp = transp * root_distribution.<a class="code hl_variable" href="structrd__str.html#ab5c89562271d3c87e310c002806858ae">rootDist</a>[0];</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>            EvapoTra = Ctransp + Sevap;</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>            <span class="keyword">constexpr</span> <span class="keywordtype">double</span> density_of_water_at_20_celcius = 0.9982;  <span class="comment">// Mg m^-3.</span></div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>            Newpawha = pawha - EvapoTra / density_of_water_at_20_celcius;</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>            <span class="comment">/* The first term in the rhs pawha is the m3 of water available in this layer.</span></div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span><span class="comment">               EvapoTra is the Mg H2O ha-1 of transpired and evaporated water. 1/0.9882 converts from Mg to m3 */</span></div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>            Ctransp = transp * root_distribution.<a class="code hl_variable" href="structrd__str.html#ab5c89562271d3c87e310c002806858ae">rootDist</a>[i];</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>            EvapoTra = Ctransp;</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>            Newpawha = pawha - (EvapoTra + oldEvapoTra);</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>        }</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span> </div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>        <span class="keywordflow">if</span> (Newpawha &lt; 0) {</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>            <span class="comment">/* If the Demand is not satisfied by this layer. This will be stored and added to subsequent layers*/</span></div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>            oldEvapoTra = -Newpawha;</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>            aw = soil_wilting_point * layerDepth;</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>        }</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span> </div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>        <span class="keywordtype">double</span> awc = Newpawha / 1e4 / layerDepth + soil_wilting_point;</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span> </div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>        <span class="comment">/* This might look like a weird place to populate the structure, but is more convenient*/</span></div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>        return_value.<a class="code hl_variable" href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">cws</a>[i] = awc;</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span> </div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>        <span class="comment">// To-do: Replace this block with a call to compute_wsPhoto.</span></div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>        <span class="comment">/* three different type of equations for modeling the effect of water stress on vmax and leaf area expansion.</span></div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span><span class="comment">       The equation for leaf area expansion is more severe than the one for vmax. */</span></div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>        <span class="keywordtype">double</span> wsPhoto = 0.0;</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>        <span class="keywordtype">double</span> slp = 0.0;</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>        <span class="keywordtype">double</span> intcpt = 0.0;</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>        <span class="keywordtype">double</span> theta = 0.0;</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span> </div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>        <span class="keywordflow">if</span> (wsFun == 0) { <span class="comment">/* linear */</span></div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>            slp = 1 / (soil_field_capacity - soil_wilting_point);</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>            intcpt = 1 - soil_field_capacity * slp;</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>            wsPhoto = slp * awc + intcpt;</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wsFun == 1) {</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>            <span class="keywordtype">double</span> phi10 = (soil_field_capacity + soil_wilting_point) / 2;</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>            wsPhoto = 1 / (1 + exp((phi10 - awc) / phi1));</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wsFun == 2) {</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>            slp = (1 - soil_wilting_point) / (soil_field_capacity - soil_wilting_point);</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>            intcpt = 1 - soil_field_capacity * slp;</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>            theta = slp * awc + intcpt;</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>            wsPhoto = (1 - exp(-2.5 * (theta - soil_wilting_point) / (1 - soil_wilting_point))) / (1 - exp(-2.5));</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wsFun == 3) {</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>            wsPhoto = 1;</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>        }</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span> </div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>        <span class="keywordflow">if</span> (wsPhoto &lt;= 0)</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>            wsPhoto = 1e-10; <span class="comment">/* This can be mathematically lower than zero in some cases but I should prevent that. */</span></div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span> </div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>        wsPhotoCol += wsPhoto;</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span> </div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>        <span class="keywordtype">double</span> LeafWS = pow(awc, phi2) * 1 / pow(soil_field_capacity, phi2);</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>        <span class="keywordflow">if</span> (wsFun == 3) {</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>            LeafWS = 1;</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>        }</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>        LeafWSCol += LeafWS;</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>    }</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span> </div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>    <span class="keywordflow">if</span> (waterIn &gt; 0) {</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>        drainage = waterIn;</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>        <span class="comment">/* Need to convert to units used in the Parton et al 1988 paper. */</span></div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>        <span class="comment">/* The data comes in mm/hr and it needs to be in cm/month */</span></div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>        return_value.<a class="code hl_variable" href="structsoil_m_l__str.html#a26953bee326ec08f079e24838fc8feb6">Nleach</a> = drainage * 0.1 * (1 / 24 * 30) / (1e3 * physical_constants::molar_mass_of_water * (0.2 + 0.7 * soil_sand_content));</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>        return_value.<a class="code hl_variable" href="structsoil_m_l__str.html#a26953bee326ec08f079e24838fc8feb6">Nleach</a> = 0.0;</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>    }</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span> </div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>    return_value.<a class="code hl_variable" href="structsoil_m_l__str.html#a50be45bf1a7676b85f348d2a38d900b7">rcoefPhoto</a> = (wsPhotoCol / layers);</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>    return_value.<a class="code hl_variable" href="structsoil_m_l__str.html#a6b156f63a9c5f2185dcb004e85518998">drainage</a> = drainage;</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>    return_value.<a class="code hl_variable" href="structsoil_m_l__str.html#aff37ff3493aa80130290d80445e09c03">rcoefSpleaf</a> = (LeafWSCol / layers);</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>    return_value.<a class="code hl_variable" href="structsoil_m_l__str.html#a1181d419ee6ec88951ccc5d991626005">SoilEvapo</a> = Sevap;</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span> </div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>    <span class="keywordflow">return</span> return_value;</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>}</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span> </div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#ac0cb91d103489dd5260fe85905dbcde9"> 1056</a></span><span class="keywordtype">double</span> <a class="code hl_function" href="_aux_bio_cro_8cpp.html#ac0cb91d103489dd5260fe85905dbcde9">resp</a>(<span class="keywordtype">double</span> base_rate, <span class="keywordtype">double</span> mrc, <span class="keywordtype">double</span> temp)</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>{</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>    <span class="keywordtype">double</span> ans = base_rate * (1 - (mrc * pow(2, (temp / 10.0))));</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span> </div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>    <span class="keywordflow">if</span> (ans &lt; 0) ans = 0;</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span> </div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>    <span class="keywordflow">return</span> ans;</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>}</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span> </div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#a50e5b19a1057a9edb5782670fb014d28"> 1065</a></span><a class="code hl_struct" href="structseq_r_d__str.html">seqRD_str</a> <a class="code hl_function" href="_aux_bio_cro_8cpp.html#a50e5b19a1057a9edb5782670fb014d28">seqRootDepth</a>(<span class="keywordtype">double</span> to, <span class="keywordtype">int</span> lengthOut)</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>{</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>    <span class="keywordtype">double</span> by = to / lengthOut;</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span> </div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>    <a class="code hl_struct" href="structseq_r_d__str.html">seqRD_str</a> result;</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;= lengthOut; ++i) {</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>        result.<a class="code hl_variable" href="structseq_r_d__str.html#a510f69db6ac897b84a1d62973c365234">rootDepths</a>[i] = i * by;</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>    }</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>}</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span> </div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"><a class="line" href="_aux_bio_cro_8cpp.html#afc92a0998ee191ec72b256ad232804c9"> 1076</a></span><a class="code hl_struct" href="structrd__str.html">rd_str</a> <a class="code hl_function" href="_aux_bio_cro_8cpp.html#afc92a0998ee191ec72b256ad232804c9">rootDist</a>(<span class="keywordtype">int</span> n_layers, <span class="keywordtype">double</span> rootDepth, <span class="keywordtype">double</span>* depths, <span class="keywordtype">double</span> rfl)</div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>{</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span><span class="comment">     * Calculate the fraction of total root mass for each layer in `depths` assuming the mass</span></div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span><span class="comment">     * is follows a Poisson distribution along the depth.</span></div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span><span class="comment">     *</span></div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span><span class="comment">     * Returns a struct with one array of size `n_layers`.</span></div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span><span class="comment">     * Each element in the array is the fraction of total root mass in that layer.</span></div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span><span class="comment">     * The sum of all elements of the result equals 1.</span></div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span><span class="comment">     */</span></div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span> </div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>    <span class="keywordtype">double</span> layerDepth = 0.0;</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>    <span class="keywordtype">double</span> CumLayerDepth = 0.0;</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>    <span class="keywordtype">int</span> CumRootDist = 1;</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>    <span class="keywordtype">double</span> <a class="code hl_function" href="_aux_bio_cro_8cpp.html#afc92a0998ee191ec72b256ad232804c9">rootDist</a>[n_layers];</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>    <span class="keywordtype">double</span> cumulative_a = 0.0;</div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span> </div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n_layers; ++i) {</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>        <span class="keywordflow">if</span> (i == 0) {</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>            layerDepth = depths[1];</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>            layerDepth = depths[i] - depths[i - 1];</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>        }</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span> </div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>        CumLayerDepth += layerDepth;</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span> </div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>        <span class="keywordflow">if</span> (rootDepth &gt; CumLayerDepth) {</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>            CumRootDist++;</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>        }</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>    }</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span> </div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; n_layers; ++j) {</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>        <span class="keywordflow">if</span> (j &lt; CumRootDist) {</div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>            <span class="keywordtype">double</span> a = <a class="code hl_function" href="_aux_bio_cro_8cpp.html#add002b19ebc8390b467dd10c31bb2cb5">poisson_density</a>(j + 1, (<span class="keywordtype">double</span>)CumRootDist * rfl);</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>            <a class="code hl_function" href="_aux_bio_cro_8cpp.html#afc92a0998ee191ec72b256ad232804c9">rootDist</a>[j] = a;</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>            cumulative_a += a;</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>            <a class="code hl_function" href="_aux_bio_cro_8cpp.html#afc92a0998ee191ec72b256ad232804c9">rootDist</a>[j] = 0;</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>        }</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>    }</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span> </div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>    <a class="code hl_struct" href="structrd__str.html">rd_str</a> result;</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; n_layers; ++k) {</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>        result.<a class="code hl_variable" href="structrd__str.html#ab5c89562271d3c87e310c002806858ae">rootDist</a>[k] = <a class="code hl_function" href="_aux_bio_cro_8cpp.html#afc92a0998ee191ec72b256ad232804c9">rootDist</a>[k] / cumulative_a;</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>    }</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>}</div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a058be0e6ed718b377d7c6056cceb09a8"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a058be0e6ed718b377d7c6056cceb09a8">compute_wsPhoto</a></div><div class="ttdeci">double compute_wsPhoto(int wsFun, double fieldc, double wiltp, double phi1, double awc)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00620">AuxBioCro.cpp:620</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a2905c23b422ad454d9577841ca594d0d"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a2905c23b422ad454d9577841ca594d0d">LNprof</a></div><div class="ttdeci">void LNprof(double LeafN, double LAI, int nlayers, double kpLN, double *leafN_profile)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00182">AuxBioCro.cpp:182</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a33949e3620b40eedec427390bde216f0"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a33949e3620b40eedec427390bde216f0">leaf_boundary_layer_conductance_thornley</a></div><div class="ttdeci">double leaf_boundary_layer_conductance_thornley(double CanopyHeight, double WindSpeed, double minimum_gbw, double WindSpeedHeight)</div><div class="ttdoc">Calculates the conductance for water vapor flow from the leaf across its boundary layer using a model...</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00481">AuxBioCro.cpp:481</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a50e5b19a1057a9edb5782670fb014d28"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a50e5b19a1057a9edb5782670fb014d28">seqRootDepth</a></div><div class="ttdeci">seqRD_str seqRootDepth(double to, int lengthOut)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l01065">AuxBioCro.cpp:1065</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a7f7b8457e2206d31608f20cc696341b7"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a7f7b8457e2206d31608f20cc696341b7">soilML</a></div><div class="ttdeci">soilML_str soilML(double precipit, double transp, double *cws, double soildepth, double *depths, double soil_field_capacity, double soil_wilting_point, double soil_saturation_capacity, double soil_air_entry, double soil_saturated_conductivity, double soil_b_coefficient, double soil_sand_content, double phi1, double phi2, int wsFun, int layers, double rootDB, double LAI, double k, double AirTemp, double IRad, double winds, double RelH, int hydrDist, double rfl, double rsec, double rsdf, double soil_clod_size, double soil_reflectance, double soil_transmission, double specific_heat_of_air, double par_energy_content)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00741">AuxBioCro.cpp:741</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_a7ffa2369991fbb92c2cf4fef41743e49"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#a7ffa2369991fbb92c2cf4fef41743e49">leaf_boundary_layer_conductance_nikolov</a></div><div class="ttdeci">double leaf_boundary_layer_conductance_nikolov(double windspeed, double leafwidth, double air_temperature, double delta_t, double stomcond, double water_vapor_pressure, double minimum_gbw)</div><div class="ttdoc">Calculates the conductance for water vapor flow from the leaf across its boundary layer using a model...</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00383">AuxBioCro.cpp:383</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_aa4d2cdd07093428af4830f4c8afd660c"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#aa4d2cdd07093428af4830f4c8afd660c">RHprof</a></div><div class="ttdeci">void RHprof(double RH, int nlayers, double *relative_humidity_profile)</div><div class="ttdoc">Calculates a relative humidity profile throughout a multilayer canopy.</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00164">AuxBioCro.cpp:164</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ab163aedfdfb73c66e5eb8dca307016be"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ab163aedfdfb73c66e5eb8dca307016be">SoilEvapo</a></div><div class="ttdeci">double SoilEvapo(double LAI, double k, double air_temperature, double ppfd, double soil_water_content, double fieldc, double wiltp, double winds, double RelH, double rsec, double soil_clod_size, double soil_reflectance, double soil_transmission, double specific_heat_of_air, double par_energy_content)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00524">AuxBioCro.cpp:524</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_abc33067b20ffdc9e7a47aafe66d7b131"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#abc33067b20ffdc9e7a47aafe66d7b131">EvapoTrans2</a></div><div class="ttdeci">ET_Str EvapoTrans2(double absorbed_shortwave_radiation_et, double absorbed_shortwave_radiation_lt, double airTemp, double RH, double WindSpeed, double stomatal_conductance, double leaf_width, double specific_heat_of_air, double minimum_gbw, int eteq)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00191">AuxBioCro.cpp:191</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ac0cb91d103489dd5260fe85905dbcde9"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ac0cb91d103489dd5260fe85905dbcde9">resp</a></div><div class="ttdeci">double resp(double base_rate, double mrc, double temp)</div><div class="ttdoc">Subtracts respiratory losses from a carbon production rate.</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l01056">AuxBioCro.cpp:1056</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_ad5f0fc680176f312e47c32701ce779f7"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#ad5f0fc680176f312e47c32701ce779f7">WINDprof</a></div><div class="ttdeci">void WINDprof(double WindSpeed, double LAI, int nlayers, double *wind_speed_profile)</div><div class="ttdoc">Wind profile function.</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00065">AuxBioCro.cpp:65</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_add002b19ebc8390b467dd10c31bb2cb5"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#add002b19ebc8390b467dd10c31bb2cb5">poisson_density</a></div><div class="ttdeci">double poisson_density(int x, double lambda)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00036">AuxBioCro.cpp:36</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_afc92a0998ee191ec72b256ad232804c9"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#afc92a0998ee191ec72b256ad232804c9">rootDist</a></div><div class="ttdeci">rd_str rootDist(int n_layers, double rootDepth, double *depths, double rfl)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l01076">AuxBioCro.cpp:1076</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8cpp_html_afd82d6a23b65b58f4b7652dc9c8146c3"><div class="ttname"><a href="_aux_bio_cro_8cpp.html#afd82d6a23b65b58f4b7652dc9c8146c3">watstr</a></div><div class="ttdeci">ws_str watstr(double precipit, double evapo, double cws, double soildepth, double fieldc, double wiltp, double soil_saturation_capacity, double sand, double Ks, double air_entry, double b)</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8cpp_source.html#l00674">AuxBioCro.cpp:674</a></div></div>
<div class="ttc" id="a_aux_bio_cro_8h_html_a57179778cb6aed95fb9f484b55873d6f"><div class="ttname"><a href="_aux_bio_cro_8h.html#a57179778cb6aed95fb9f484b55873d6f">MAXLAY</a></div><div class="ttdeci">#define MAXLAY</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00012">AuxBioCro.h:12</a></div></div>
<div class="ttc" id="a_bio_cro_8h_html"><div class="ttname"><a href="_bio_cro_8h.html">BioCro.h</a></div></div>
<div class="ttc" id="ac4photo_8h_html"><div class="ttname"><a href="c4photo_8h.html">c4photo.h</a></div></div>
<div class="ttc" id="astruct_e_t___str_html"><div class="ttname"><a href="struct_e_t___str.html">ET_Str</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00014">AuxBioCro.h:14</a></div></div>
<div class="ttc" id="astruct_e_t___str_html_a45c6793a51f491bf058f154777e48ec9"><div class="ttname"><a href="struct_e_t___str.html#a45c6793a51f491bf058f154777e48ec9">ET_Str::EPriestly</a></div><div class="ttdeci">double EPriestly</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00017">AuxBioCro.h:17</a></div></div>
<div class="ttc" id="astruct_e_t___str_html_a488dc75fbd1ec09aba81e6016377c7f0"><div class="ttname"><a href="struct_e_t___str.html#a488dc75fbd1ec09aba81e6016377c7f0">ET_Str::boundary_layer_conductance</a></div><div class="ttdeci">double boundary_layer_conductance</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00019">AuxBioCro.h:19</a></div></div>
<div class="ttc" id="astruct_e_t___str_html_a53d1afc42e3609e6eb8145169c7b5aaf"><div class="ttname"><a href="struct_e_t___str.html#a53d1afc42e3609e6eb8145169c7b5aaf">ET_Str::TransR</a></div><div class="ttdeci">double TransR</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00015">AuxBioCro.h:15</a></div></div>
<div class="ttc" id="astruct_e_t___str_html_a7ee08add5c06f347e177447a6516ca01"><div class="ttname"><a href="struct_e_t___str.html#a7ee08add5c06f347e177447a6516ca01">ET_Str::EPenman</a></div><div class="ttdeci">double EPenman</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00016">AuxBioCro.h:16</a></div></div>
<div class="ttc" id="astruct_e_t___str_html_ac321dc561843cb5d3f74604036a3a8da"><div class="ttname"><a href="struct_e_t___str.html#ac321dc561843cb5d3f74604036a3a8da">ET_Str::Deltat</a></div><div class="ttdeci">double Deltat</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00018">AuxBioCro.h:18</a></div></div>
<div class="ttc" id="astructrd__str_html"><div class="ttname"><a href="structrd__str.html">rd_str</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00055">AuxBioCro.h:55</a></div></div>
<div class="ttc" id="astructrd__str_html_ab5c89562271d3c87e310c002806858ae"><div class="ttname"><a href="structrd__str.html#ab5c89562271d3c87e310c002806858ae">rd_str::rootDist</a></div><div class="ttdeci">double rootDist[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00056">AuxBioCro.h:56</a></div></div>
<div class="ttc" id="astructseq_r_d__str_html"><div class="ttname"><a href="structseq_r_d__str.html">seqRD_str</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00049">AuxBioCro.h:49</a></div></div>
<div class="ttc" id="astructseq_r_d__str_html_a510f69db6ac897b84a1d62973c365234"><div class="ttname"><a href="structseq_r_d__str.html#a510f69db6ac897b84a1d62973c365234">seqRD_str::rootDepths</a></div><div class="ttdeci">double rootDepths[MAXLAY+1]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00050">AuxBioCro.h:50</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html"><div class="ttname"><a href="structsoil_m_l__str.html">soilML_str</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00029">AuxBioCro.h:29</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_a1181d419ee6ec88951ccc5d991626005"><div class="ttname"><a href="structsoil_m_l__str.html#a1181d419ee6ec88951ccc5d991626005">soilML_str::SoilEvapo</a></div><div class="ttdeci">double SoilEvapo</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00035">AuxBioCro.h:35</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_a26953bee326ec08f079e24838fc8feb6"><div class="ttname"><a href="structsoil_m_l__str.html#a26953bee326ec08f079e24838fc8feb6">soilML_str::Nleach</a></div><div class="ttdeci">double Nleach</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00034">AuxBioCro.h:34</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_a50be45bf1a7676b85f348d2a38d900b7"><div class="ttname"><a href="structsoil_m_l__str.html#a50be45bf1a7676b85f348d2a38d900b7">soilML_str::rcoefPhoto</a></div><div class="ttdeci">double rcoefPhoto</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00030">AuxBioCro.h:30</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_a6b156f63a9c5f2185dcb004e85518998"><div class="ttname"><a href="structsoil_m_l__str.html#a6b156f63a9c5f2185dcb004e85518998">soilML_str::drainage</a></div><div class="ttdeci">double drainage</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00033">AuxBioCro.h:33</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_a9da7a4e25e646b0be31ac3bbec73f60d"><div class="ttname"><a href="structsoil_m_l__str.html#a9da7a4e25e646b0be31ac3bbec73f60d">soilML_str::cws</a></div><div class="ttdeci">double cws[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00032">AuxBioCro.h:32</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_ab5c89562271d3c87e310c002806858ae"><div class="ttname"><a href="structsoil_m_l__str.html#ab5c89562271d3c87e310c002806858ae">soilML_str::rootDist</a></div><div class="ttdeci">double rootDist[MAXLAY]</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00036">AuxBioCro.h:36</a></div></div>
<div class="ttc" id="astructsoil_m_l__str_html_aff37ff3493aa80130290d80445e09c03"><div class="ttname"><a href="structsoil_m_l__str.html#aff37ff3493aa80130290d80445e09c03">soilML_str::rcoefSpleaf</a></div><div class="ttdeci">double rcoefSpleaf</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00031">AuxBioCro.h:31</a></div></div>
<div class="ttc" id="astructws__str_html"><div class="ttname"><a href="structws__str.html">ws_str</a></div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00022">AuxBioCro.h:22</a></div></div>
<div class="ttc" id="astructws__str_html_a26953bee326ec08f079e24838fc8feb6"><div class="ttname"><a href="structws__str.html#a26953bee326ec08f079e24838fc8feb6">ws_str::Nleach</a></div><div class="ttdeci">double Nleach</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00026">AuxBioCro.h:26</a></div></div>
<div class="ttc" id="astructws__str_html_a365dc60f2331a4280fc2be55b822191c"><div class="ttname"><a href="structws__str.html#a365dc60f2331a4280fc2be55b822191c">ws_str::runoff</a></div><div class="ttdeci">double runoff</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00025">AuxBioCro.h:25</a></div></div>
<div class="ttc" id="astructws__str_html_aa293628634276d793267cbf2542ce2e2"><div class="ttname"><a href="structws__str.html#aa293628634276d793267cbf2542ce2e2">ws_str::awc</a></div><div class="ttdeci">double awc</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00023">AuxBioCro.h:23</a></div></div>
<div class="ttc" id="astructws__str_html_ac2f458ad74016a5af57f18d9774bb0d9"><div class="ttname"><a href="structws__str.html#ac2f458ad74016a5af57f18d9774bb0d9">ws_str::psim</a></div><div class="ttdeci">double psim</div><div class="ttdef"><b>Definition:</b> <a href="_aux_bio_cro_8h_source.html#l00024">AuxBioCro.h:24</a></div></div>
<div class="ttc" id="asun_m_l_8cpp_html_ab491bb8553ee710f275dbcd2b3e4547b"><div class="ttname"><a href="sun_m_l_8cpp.html#ab491bb8553ee710f275dbcd2b3e4547b">thick_layer_absorption</a></div><div class="ttdeci">double thick_layer_absorption(double R, double T, double I_0)</div><div class="ttdoc">Computes absorbed light from incident light for a thick layer of material.</div><div class="ttdef"><b>Definition:</b> <a href="sun_m_l_8cpp_source.html#l00079">sunML.cpp:79</a></div></div>
<div class="ttc" id="asun_m_l_8h_html"><div class="ttname"><a href="sun_m_l_8h.html">sunML.h</a></div></div>
<div class="ttc" id="awater__and__air__properties_8h_html"><div class="ttname"><a href="water__and__air__properties_8h.html">water_and_air_properties.h</a></div></div>
<div class="ttc" id="awater__and__air__properties_8h_html_a05f381bbff6170709a8d0e2e34f4556a"><div class="ttname"><a href="water__and__air__properties_8h.html#a05f381bbff6170709a8d0e2e34f4556a">TempToSFS</a></div><div class="ttdeci">double TempToSFS(double air_temperature)</div><div class="ttdoc">Determine the derivative of saturation water vapor pressure with respect to temperature at a particul...</div><div class="ttdef"><b>Definition:</b> <a href="water__and__air__properties_8h_source.html#l00173">water_and_air_properties.h:173</a></div></div>
<div class="ttc" id="awater__and__air__properties_8h_html_a117fba2c85ba6d52345e7cefc05a43ff"><div class="ttname"><a href="water__and__air__properties_8h.html#a117fba2c85ba6d52345e7cefc05a43ff">saturation_vapor_pressure</a></div><div class="ttdeci">double saturation_vapor_pressure(double air_temperature)</div><div class="ttdoc">Determine saturation water vapor pressure (Pa) from air temperature (degrees C) using the Arden Buck ...</div><div class="ttdef"><b>Definition:</b> <a href="water__and__air__properties_8h_source.html#l00030">water_and_air_properties.h:30</a></div></div>
<div class="ttc" id="awater__and__air__properties_8h_html_a460579178484521ecc50b488c58bb0dd"><div class="ttname"><a href="water__and__air__properties_8h.html#a460579178484521ecc50b488c58bb0dd">TempToLHV</a></div><div class="ttdeci">double TempToLHV(double temperature)</div><div class="ttdoc">Determine the latent heat of vaporization for water from its temperature.</div><div class="ttdef"><b>Definition:</b> <a href="water__and__air__properties_8h_source.html#l00120">water_and_air_properties.h:120</a></div></div>
<div class="ttc" id="awater__and__air__properties_8h_html_a6380d8cd4192408df76baefe6b369a70"><div class="ttname"><a href="water__and__air__properties_8h.html#a6380d8cd4192408df76baefe6b369a70">TempToDdryA</a></div><div class="ttdeci">double TempToDdryA(double air_temperature)</div><div class="ttdoc">Determines the density of dry air from the air temperature.</div><div class="ttdef"><b>Definition:</b> <a href="water__and__air__properties_8h_source.html#l00064">water_and_air_properties.h:64</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_567355a66c5b87dfe03a58cbdce72993.html">module_library</a></li><li class="navelem"><a class="el" href="_aux_bio_cro_8cpp.html">AuxBioCro.cpp</a></li>
    <li class="footer">Generated on Tue Oct 31 2023 16:33:40 for The BioCro C++ Library by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
