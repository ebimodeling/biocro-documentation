<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="BioCro">
<title>Using the Ball-Berry Model in Crop Growth Simulations • BioCro</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using the Ball-Berry Model in Crop Growth Simulations">
<meta property="og:description" content="BioCro">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BioCro</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../about_pkgdown_documentation.html">About</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>GENERAL BIOCRO USAGE</h6>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/a_practical_guide_to_biocro.pdf">A Practical Guide to BioCro (PDF)</a>
    <a class="dropdown-item" href="../articles/a_practical_guide_to_biocro.R">    [R code]</a>
    <a class="dropdown-item" href="../articles/quantitative_model_comparison.pdf">Quantitative Comparison Between Two Photosynthesis Models (PDF)</a>
    <a class="dropdown-item" href="../articles/quantitative_model_comparison.R">    [R code]</a>
    <a class="dropdown-item" href="../articles/BioCro-II_Paper--Section-1.1-example.html">BioCro II Paper: Section 1.1 Example (HTML)</a>
    <a class="dropdown-item" href="../articles/dynamical_systems.pdf">BioCro as a Dynamical System</a>
    <a class="dropdown-item" href="../articles/an_introduction_to_biocro.pdf">An Introduction to BioCro for Those Who Want to Add Models (PDF)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>CROP GROWTH MODELING TOPICS</h6>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/avoiding_pitfalls_fvcb.html">Avoiding Pitfalls When Using the FvCB Model (HTML)</a>
    <a class="dropdown-item" href="../articles/thick_layer_absorption.html">Light Absorption by a Thick Layer (HTML)</a>
    <a class="dropdown-item" href="../articles/ball_berry_model.html">Using the Ball-Berry Model (HTML)</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../bookdown/index.html">Developer's Manual</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-c-library">C++ Library</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-c-library">
    <a class="dropdown-item" href="../../doxygen/doxygen_docs_complete/index.html">Complete Doxygen Documentation</a>
    <a class="dropdown-item" href="../../doxygen/doxygen_docs_framework/index.html">Framework Documentation</a>
    <a class="dropdown-item" href="../../doxygen/doxygen_docs_modules/index.html">BioCro Module Documentation</a>
    <a class="dropdown-item" href="../../doxygen/doxygen_docs_modules_public_members_only/index.html">BioCro Module Documentation (public members only)</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ebimodeling/biocro/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Using the Ball-Berry Model in Crop Growth Simulations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ebimodeling/biocro/blob/HEAD/vignettes/ball_berry_model.Rmd" class="external-link"><code>vignettes/ball_berry_model.Rmd</code></a></small>
      <div class="d-none name"><code>ball_berry_model.Rmd</code></div>
    </div>

    
    
<div class="section level2" number="1">
<h2 id="overview">
<span class="header-section-number">1</span> Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The Ball-Berry is a simple empirical model for the steady-state response of
stomata to external conditions and was first described in <span class="citation">Ball et al. (<a href="#ref-ball_model_1987" role="doc-biblioref">1987</a>)</span>. The
main idea is that stomata open in response to brighter light or low CO<span class="math inline">\(_2\)</span>
availability, and close in response to low humidity (to limit water losses from
transpiration). This idea can be expressed mathematically as</p>
<p><span class="math display" id="eq:bb">\[\begin{equation}
  g_{sw} = b_0 + b_1 \cdot \frac{ A_n \cdot h_s}{C_s} \quad
    \text{if} \; A_n \geq 0, \tag{1.1}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(g_{sw}\)</span> is the stomatal conductance to water vapor diffusion, <span class="math inline">\(A_n\)</span> is
the net CO<span class="math inline">\(_2\)</span> assimilation rate, <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span> are the Ball-Berry intercept
and slope, <span class="math inline">\(h_s\)</span> is the relative humidity at the leaf surface, and <span class="math inline">\(C_s\)</span> is the
CO<span class="math inline">\(_2\)</span> concentration at the leaf surface. When <span class="math inline">\(A_n &lt; 0\)</span>, <span class="math inline">\(g_{sw} = b_0\)</span>. Here,
the net assimilation is a proxy for the incident light intensity and
captures the nonlinear response of <span class="math inline">\(g_{sw}\)</span> to light. The quantity
<span class="math inline">\(A_n \cdot h_s / C_s\)</span> is often called the Ball-Berry index; thus, the model
states that stomatal conductance is a linear function of the Ball-Berry index,
and the model is parameterized by the Ball-Berry slope and intercept.</p>
<p>Several critiques of this model have been made, and other models of stomatal
response exist
<span class="citation">(<a href="#ref-tardieu_integration_1993" role="doc-biblioref">Tardieu and Davies 1993</a>; <a href="#ref-leuning_critical_1995" role="doc-biblioref">Leuning 1995</a>; <a href="#ref-dewar_ballberryleuning_2002" role="doc-biblioref">Dewar 2002</a>)</span>.
Nevertheless, the Ball-Berry model remains widely-used due to its simplicity.
(However, as we will see in the following section, it is not always so simple to
use in the context of crop growth modeling!)</p>
</div>
<div class="section level2" number="2">
<h2 id="using-the-model-for-crop-growth-modeling">
<span class="header-section-number">2</span> Using the Model for Crop Growth Modeling<a class="anchor" aria-label="anchor" href="#using-the-model-for-crop-growth-modeling"></a>
</h2>
<p>There are several complexities associated with using this equation for crop
growth modeling. One is that <span class="math inline">\(A_n\)</span> depends on the CO<span class="math inline">\(_2\)</span> concentration inside
the leaf, so combined models employing the Ball-Berry equation and mechanistic
equations for photosynthesis must generally be solved iteratively. Another
complexity associated with crop growth modeling is that the CO<span class="math inline">\(_2\)</span> and H<span class="math inline">\(_2\)</span>O
concentrations at the leaf surface are not usually known beforehand. Instead,
they must be determined from the ambient values, boundary layer conductances,
and fluxes using one-dimensional gas flow equations of the form
<span class="math inline">\(F = g \cdot (c_2 - c_1)\)</span>, where <span class="math inline">\(F\)</span> is a flux, <span class="math inline">\(g\)</span> is a conductance, and
<span class="math inline">\(c_1\)</span> and <span class="math inline">\(c_2\)</span> are gas concentrations at two physical locations. The remainder
of this section will describe how these gas flow equations can be used to
determine <span class="math inline">\(C_s\)</span> and <span class="math inline">\(h_s\)</span>.</p>
<div class="section level3" number="2.1">
<h3 id="determining-c_s">
<span class="header-section-number">2.1</span> Determining <span class="math inline">\(C_s\)</span><a class="anchor" aria-label="anchor" href="#determining-c_s"></a>
</h3>
<p>Assuming steady-state conditions, the CO<span class="math inline">\(_2\)</span> flux across the boundary layer is
given by <span class="math inline">\(A_n\)</span>, allowing us to find <span class="math inline">\(C_s\)</span> using a single gas flow equation:</p>
<p><span class="math display" id="eq:cs">\[\begin{equation}
  C_s = C_a - \frac{A_n}{g_{bc}} = C_a - \frac{A_n \cdot 1.37}{g_{bw}},
    \tag{2.1}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(C_a\)</span> is the ambient CO<span class="math inline">\(_2\)</span> concentration, <span class="math inline">\(g_{bc}\)</span> is the boundary layer
conductance to CO<span class="math inline">\(_2\)</span> diffusion, and <span class="math inline">\(g_{bw}\)</span> is the boundary layer
conductance to water vapor diffusion. The two conductances are related by the
ratio of diffusivities of CO<span class="math inline">\(_2\)</span> and H<span class="math inline">\(_2\)</span>O in the boundary layer, which is
typically taken to be 1.37. (For more information about this ratio and its
value, see the discussion following Equation B16 in
<span class="citation">Caemmerer and Farquhar (<a href="#ref-von_caemmerer_relationships_1981" role="doc-biblioref">1981</a>)</span>.)</p>
</div>
<div class="section level3" number="2.2">
<h3 id="determining-h_s">
<span class="header-section-number">2.2</span> Determining <span class="math inline">\(h_s\)</span><a class="anchor" aria-label="anchor" href="#determining-h_s"></a>
</h3>
<p>The situation with water vapor is more complicated. The first point is that
water vapor flows along concentration gradients, <em>not</em> relative humidity
gradients. Concentrations and relative humidities are related by</p>
<p><span class="math display" id="eq:hw">\[\begin{equation}
  h = P_w / P_{w,sat}(T) = w \cdot P_{tot} / P_{w,sat}(T), \tag{2.2}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(h\)</span> is the relative humidity, <span class="math inline">\(w\)</span> is the water vapor concentration, <span class="math inline">\(P_w\)</span>
is the partial pressure of water vapor, <span class="math inline">\(P_{w,sat}(T)\)</span> is the saturation water
vapor pressure corresponding to the air temperature <span class="math inline">\(T\)</span>, and <span class="math inline">\(P_{tot}\)</span> is the
total gas pressure. The second point is that the water vapor flux <span class="math inline">\(E\)</span> is
initially unknown; instead, we assume that water vapor is fully saturated within
the leaf and that the water vapor flow has reached steady-state conditions.</p>
<p>Thus, we can begin with two gas flow equations corresponding to water vapor
flux across the boundary layer and stomata (<span class="math inline">\(E_b\)</span> and <span class="math inline">\(E_s\)</span>, respectively):</p>
<p><span class="math display" id="eq:fluxbdry">\[\begin{equation}
  E_b = g_{bw} \cdot (w_s - w_a) \tag{2.3}
\end{equation}\]</span></p>
<p>and</p>
<p><span class="math display" id="eq:fluxstom">\[\begin{equation}
  E_s = g_{sw} \cdot (w_i - w_s), \tag{2.4}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(w_a\)</span>, <span class="math inline">\(w_s\)</span>, and <span class="math inline">\(w_i\)</span> are the water vapor concentrations in the ambient
air, at the leaf surface, and in the leaf interior, respectively. Note that
Equation <a href="#eq:hw">(2.2)</a> can be used to re-express these concentrations using the
corresponding relative humidities (<span class="math inline">\(h_a\)</span>, <span class="math inline">\(h_s\)</span>, and <span class="math inline">\(h_i\)</span>) and air temperatures
(<span class="math inline">\(T_a\)</span>, <span class="math inline">\(T_s\)</span>, and <span class="math inline">\(T_i\)</span>) at the same locations as follows:</p>
<p><span class="math display" id="eq:rh">\[\begin{align}
  w_a &amp;= h_a \cdot \frac{P_{w,sat}(T_a)}{P_{tot}} \\
  w_s &amp;= h_s \cdot \frac{P_{w,sat}(T_s)}{P_{tot}} \\
  w_i &amp;= h_i \cdot \frac{P_{w,sat}(T_i)}{P_{tot}} =
    \frac{P_{w,sat}(T_i)}{P_{tot}}, \tag{2.5}
\end{align}\]</span></p>
<p>where we have set <span class="math inline">\(h_i = 1\)</span> in the latter to reflect the assumption that water
vapor is saturated inside the leaf. The leaf’s surface and its interior spaces
are assumed to have the same temperature and hence the same saturation water
vapor pressure, so we can also set</p>
<p><span class="math display" id="eq:tl">\[\begin{equation}
  T_s = T_i = T_l, \tag{2.6}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(T_l\)</span> is the leaf temperature.</p>
<p>Now, we can replace <span class="math inline">\(g_{sw}\)</span> in Equation <a href="#eq:fluxstom">(2.4)</a> with the expression
from Equation <a href="#eq:bb">(1.1)</a>, replace the water vapor concentrations and
temperatures in Equations <a href="#eq:fluxbdry">(2.3)</a> and <a href="#eq:fluxstom">(2.4)</a> with the
expressions from Equations <a href="#eq:rh">(2.5)</a> and <a href="#eq:tl">(2.6)</a>, and equate the two
fluxes in Equations <a href="#eq:fluxbdry">(2.3)</a> and <a href="#eq:fluxstom">(2.4)</a> since they must be
equal under steady-state conditions. Putting this all together, we can write</p>
<p><span class="math display" id="eq:fluxbalance">\[\begin{equation}
  \frac{g_{bw}}{P_{tot}} \cdot
    \big[ h_s \cdot P_{w,sat}(T_l) - h_a \cdot P_{w,sat}(T_a) \big] =
    \frac{P_{w,sat}(T_l)}{P_{tot}} \cdot
    \left[ b_0 + b_1 \cdot \frac{A_n \cdot h_s}{C_s} \right]
    \cdot \left( 1 - h_s \right). \tag{2.7}
\end{equation}\]</span></p>
<p>When multiplied out and regrouped, Equation <a href="#eq:fluxbalance">(2.7)</a> becomes a
quadratic equation for <span class="math inline">\(h_s\)</span>:</p>
<p><span class="math display" id="eq:quadprob">\[\begin{equation}
  h_s^2 \cdot \left( b_1 \cdot \frac{A_n}{C_s} \right) +
    h_s \cdot \left( b_0 + g_{bw} - b_1 \cdot \frac{A_n}{C_s} \right) -
    \left( g_{bw} \cdot h_a \cdot \frac{P_{w,sat}(T_a)}{P_{w,sat}(T_l)} +
      b_0 \right) = 0. \tag{2.8}
\end{equation}\]</span></p>
<p>Equation <a href="#eq:quadprob">(2.8)</a> can be solved for <span class="math inline">\(h_s\)</span> using the quadratic formula:</p>
<p><span class="math display" id="eq:quadsolve">\[\begin{align}
  h_s &amp;= \frac{-b \pm \sqrt{b^2 - 4 \cdot a \cdot c}}{2 \cdot a}, \\
    a &amp;= b_1 \cdot \frac{A_n}{C_s}, \\
    b &amp;= b_0 + g_{bw} - b_1 \cdot \frac{A_n}{C_s}, \\
    c &amp;= - \left( g_{bw} \cdot h_a \cdot \frac{P_{w,sat}(T_a)}{P_{w,sat}(T_l)} +
      b_0 \right). \tag{2.9}
\end{align}\]</span></p>
<p>Note that with our assumptions, <span class="math inline">\(a \geq 0\)</span> and <span class="math inline">\(c \leq 0\)</span>. Thus,
<span class="math inline">\(b^2 - 4 \cdot a \cdot c \geq b^2\)</span>, and the <span class="math inline">\(\sqrt{b^2 - 4 \cdot a \cdot c}\)</span>
term in Equation <a href="#eq:quadsolve">(2.9)</a> is always larger than (or equal to) <span class="math inline">\(|b|\)</span>.
Thus, the “minus” root corresponds to a phyically-impossible negative value for
<span class="math inline">\(h_s\)</span>, and we always choose the “plus” root</p>
<p><span class="math display" id="eq:hs">\[\begin{equation}
  h_s = \frac{-b + \sqrt{b^2 - 4 \cdot a \cdot c}}{2 \cdot a}. \tag{2.10}
\end{equation}\]</span></p>
<div class="section level4" number="2.2.1">
<h4 id="dew">
<span class="header-section-number">2.2.1</span> Dew<a class="anchor" aria-label="anchor" href="#dew"></a>
</h4>
<p>If the leaf temperature is lower than the ambient air temperature, it is
possible for the water vapor concentration at the leaf surface to exceed the
saturation water vapor pressure at the leaf temperature. This would result
in <span class="math inline">\(h_s &gt; 1\)</span>, which is not possible. This outcome indicates that water vapor
would have condensed on the leaf surface; in other words, that dew would have
formed.</p>
</div>
</div>
</div>
<div class="section level2" number="3">
<h2 id="biocro-implementation">
<span class="header-section-number">3</span> BioCro Implementation<a class="anchor" aria-label="anchor" href="#biocro-implementation"></a>
</h2>
<p>In BioCro, the Ball-Berry model is implemented by the <code>ball_berry_gs()</code> C++
function, which calculates <span class="math inline">\(C_s\)</span>, <span class="math inline">\(h_s\)</span>, and <span class="math inline">\(g_{sw}\)</span> with Equations
<a href="#eq:cs">(2.1)</a>, <a href="#eq:hs">(2.10)</a>, and <a href="#eq:bb">(1.1)</a>. We do not have a way to deal with
dew formation in BioCro at the moment, so <span class="math inline">\(h_s \leq 1\)</span> is forced in the code.
This function can be accessed via the <code>BioCro:ball_berry</code> module.</p>
<p>The model also plays a key role in several other functions and modules that call
<code>ball_berry_gs()</code>:</p>
<ul>
<li><p>The <code>c3photoC()</code> C++ function couples the Ball-Berry model with the
Farquhar-von-Caemmerer-Berry model for C3 photosynthesis to determine <span class="math inline">\(A_n\)</span>
and <span class="math inline">\(g_{sw}\)</span> from environmental conditions. This function can be accessed via
the <code>BioCro:c3_assimilation</code> module. See the module documentation for more
information.</p></li>
<li><p>The <code>BioCro:c3_leaf_photosynthesis</code> module couples the Ball-Berry model, the
Farquhar-von-Caemmerer-Berry model for C3 photosynthesis, and the
Penman-Monteith approach to energy balance to determine <span class="math inline">\(A_n\)</span>, <span class="math inline">\(g_{sw}\)</span>, and
<span class="math inline">\(T_l\)</span> from environmental conditions. See the module documentation for more
information.</p></li>
<li><p>The <code>c3CanAC()</code> C++ function applies the fully-coupled model used by the
<code>BioCro:c3_leaf_photosynthesis</code> module to sunlit and shaded leaves within a
crop canopy to calculate canopy-level photosynthesis. This function can be
accessed via the <code>BioCro:c3_canopy</code> and <code>BioCro:ten_layer_c3_canopy</code> modules.
See the module documentation for more information.</p></li>
<li><p>The <code>c4photoC()</code> C++ function couples the Ball-Berry model with the
Collatz model for C4 photosynthesis to determine <span class="math inline">\(A_n\)</span> and <span class="math inline">\(g_{sw}\)</span> from
environmental conditions. This function can be accessed via the
<code>BioCro:c4_assimilation</code> module. See the module documentation for more
information.</p></li>
<li><p>The <code>BioCro:c4_leaf_photosynthesis</code> module couples the Ball-Berry model, the
Collatz model for C3 photosynthesis, and the Penman-Monteith approach to
energy balance to determine <span class="math inline">\(A_n\)</span>, <span class="math inline">\(g_{sw}\)</span>, and <span class="math inline">\(T_l\)</span> from environmental
conditions. See the module documentation for more information.</p></li>
<li><p>The <code>CanAC()</code> C++ function applies the fully-coupled model used by the
<code>BioCro:c4_leaf_photosynthesis</code> module to sunlit and shaded leaves within a
crop canopy to calculate canopy-level photosynthesis. This function can be
accessed via the <code>BioCro:c4_canopy</code> and <code>BioCro:ten_layer_c4_canopy</code> modules.
See the module documentation for more information.</p></li>
</ul>
</div>
<div class="section level2" number="4">
<h2 id="biocro-examples">
<span class="header-section-number">4</span> BioCro Examples<a class="anchor" aria-label="anchor" href="#biocro-examples"></a>
</h2>
<p>Here we will show how BioCro can be used to evaluate the Ball-Berry model or use
it in conjunction with other models of varying complexity. To start, we will
need to load the <code>BioCro</code> and <code>lattice</code> libraries:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ebimodeling/biocro" class="external-link">BioCro</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3" number="4.1">
<h3 id="ball-berry">
<span class="header-section-number">4.1</span> Ball-Berry<a class="anchor" aria-label="anchor" href="#ball-berry"></a>
</h3>
<p>Here we will visualize the Ball-Berry model’s output for soybean leaves with
several different values of <span class="math inline">\(A_n\)</span> and <span class="math inline">\(T_a\)</span>. We can see that <span class="math inline">\(g_{sw}\)</span> and <span class="math inline">\(h_s\)</span>
change with ambient temperature (Figures <a href="#fig:gsw-an">4.1</a> and <a href="#fig:hs-an">4.2</a>)
while <span class="math inline">\(C_s\)</span> does not (Figure <a href="#fig:cs-an">4.3</a>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Choose a leaf temperature</span></span>
<span><span class="va">Tleaf</span> <span class="op">=</span> <span class="fl">25</span> <span class="co"># degrees C</span></span>
<span></span>
<span><span class="co"># Run the model for different An and Tambient</span></span>
<span><span class="va">bb_rc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modules.html">module_response_curve</a></span><span class="op">(</span></span>
<span>  <span class="st">'BioCro:ball_berry'</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span>, <span class="op">{</span></span>
<span>    <span class="va">gbw</span> <span class="op">=</span> <span class="fl">1.2</span>                <span class="co"># mol / m^2 / s</span></span>
<span>    <span class="va">leaf_temperature</span> <span class="op">=</span> <span class="va">Tleaf</span> <span class="co"># degress C</span></span>
<span>    <span class="va">rh</span> <span class="op">=</span> <span class="fl">0.7</span>                 <span class="co"># dimensionless</span></span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>    net_assimilation_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">40</span>, length.out <span class="op">=</span> <span class="fl">201</span><span class="op">)</span>, <span class="co"># micromol / m^2 / s</span></span>
<span>    temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">Tleaf</span> <span class="op">-</span> <span class="fl">6</span>, <span class="va">Tleaf</span> <span class="op">+</span> <span class="fl">6</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>               <span class="co"># degrees C</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot gsw</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">leaf_stomatal_conductance</span> <span class="op">~</span> <span class="va">net_assimilation_rate</span>,</span>
<span>    group <span class="op">=</span> <span class="va">temp</span>,</span>
<span>    data <span class="op">=</span> <span class="va">bb_rc</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"An (micromol / m^2 / s)"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"Stomatal conductance (mmol / m^2 / s)"</span>,</span>
<span>    main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>        <span class="st">"Ball-Berry model with T_leaf ="</span>, <span class="va">Tleaf</span>,</span>
<span>        <span class="st">"\nand different T_ambient"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:gsw-an"></span>
<img src="ball_berry_model_files/figure-html/gsw-an-1.png" alt="$g_{sw}$ vs $A_n$ for several different $T_a$ as predicted by the  Ball-Berry model with soybean parameter values."><p class="caption">
Figure 4.1: <span class="math inline">\(g_{sw}\)</span> vs <span class="math inline">\(A_n\)</span> for several different <span class="math inline">\(T_a\)</span> as predicted by the Ball-Berry model with soybean parameter values.
</p>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot hs</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">hs</span> <span class="op">~</span> <span class="va">net_assimilation_rate</span>,</span>
<span>    group <span class="op">=</span> <span class="va">temp</span>,</span>
<span>    data <span class="op">=</span> <span class="va">bb_rc</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"An (micromol / m^2 / s)"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"Relative humidity at leaf surface (dimensionless)"</span>,</span>
<span>    main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>        <span class="st">"Ball-Berry model with T_leaf ="</span>, <span class="va">Tleaf</span>,</span>
<span>        <span class="st">"\nand different T_ambient"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:hs-an"></span>
<img src="ball_berry_model_files/figure-html/hs-an-1.png" alt="$h_s$ vs $A_n$ for several different $T_a$ as predicted by the  Ball-Berry model with soybean parameter values."><p class="caption">
Figure 4.2: <span class="math inline">\(h_s\)</span> vs <span class="math inline">\(A_n\)</span> for several different <span class="math inline">\(T_a\)</span> as predicted by the Ball-Berry model with soybean parameter values.
</p>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot cs</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">cs</span> <span class="op">~</span> <span class="va">net_assimilation_rate</span>,</span>
<span>    group <span class="op">=</span> <span class="va">temp</span>,</span>
<span>    data <span class="op">=</span> <span class="va">bb_rc</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"An (micromol / m^2 / s)"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"CO2 concentration at leaf surface (micromol / mol)"</span>,</span>
<span>    main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>        <span class="st">"Ball-Berry model with T_leaf ="</span>, <span class="va">Tleaf</span>,</span>
<span>        <span class="st">"\nand different T_ambient"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:cs-an"></span>
<img src="ball_berry_model_files/figure-html/cs-an-1.png" alt="$C_s$ vs $A_n$ for several different $T_a$ as predicted by the  Ball-Berry model with soybean parameter values."><p class="caption">
Figure 4.3: <span class="math inline">\(C_s\)</span> vs <span class="math inline">\(A_n\)</span> for several different <span class="math inline">\(T_a\)</span> as predicted by the Ball-Berry model with soybean parameter values.
</p>
</div>
</div>
<div class="section level3" number="4.2">
<h3 id="ball-berry-and-c3-photosynthesis">
<span class="header-section-number">4.2</span> Ball-Berry and C3 Photosynthesis<a class="anchor" aria-label="anchor" href="#ball-berry-and-c3-photosynthesis"></a>
</h3>
<p>Here we will calculate the response of <span class="math inline">\(g_{sw}\)</span> and <span class="math inline">\(A_n\)</span> to the absorbed
quantum photon flux (<span class="math inline">\(Q_{abs}\)</span>) and ambient humidity in a coupled model
incorporating the Ball-Berry and Farquhar-von-Caemmerer-Berry (FvCB) models.
Although this coupled model also gives us the option to reduce a crop’s
“inherent” Ball-Berry parameters in response to water stress, for this
simulation we will ignore water stress by setting <code>StomataWS = 1</code>. From these
calculations, we can see that the stomatal conductance increases for higher
humidities (Figure <a href="#fig:gsw-qabs">4.4</a>), and that both <span class="math inline">\(A_n\)</span> and <span class="math inline">\(g_{sw}\)</span> reach
plateaus at high light levels (Figures <a href="#fig:gsw-qabs">4.4</a> and
<a href="#fig:an-qabs">4.5</a>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the model for different Qabs and rh</span></span>
<span><span class="va">lrc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modules.html">module_response_curve</a></span><span class="op">(</span></span>
<span>  <span class="st">'BioCro:c3_assimilation'</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span>, <span class="op">{</span></span>
<span>    <span class="va">StomataWS</span> <span class="op">=</span> <span class="fl">1</span> <span class="co"># dimensionless</span></span>
<span>    <span class="va">Tleaf</span> <span class="op">=</span> <span class="fl">30</span>    <span class="co"># degrees C</span></span>
<span>    <span class="va">gbw</span> <span class="op">=</span> <span class="fl">1.2</span>     <span class="co"># mol / m^2 / s</span></span>
<span>    <span class="va">temp</span> <span class="op">=</span> <span class="fl">28</span>     <span class="co"># degrees C</span></span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>    Qabs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, <span class="co"># micromol / m^2 / s</span></span>
<span>    rh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span><span class="op">)</span>   <span class="co"># dimensionless</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot gsw</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">Gs</span> <span class="op">~</span> <span class="va">Qabs</span>,</span>
<span>    group <span class="op">=</span> <span class="va">rh</span>,</span>
<span>    data <span class="op">=</span> <span class="va">lrc</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"Absorbed PPFD (micromol / m^2 / s)"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"Stomatal conductance to H2O (mmol / m^2 / s)"</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Ball-Berry + FvCB models for\ndifferent humidities"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:gsw-qabs"></span>
<img src="ball_berry_model_files/figure-html/gsw-qabs-1.png" alt="$g_{sw}$ vs $Q_{abs}$ for several different $h_a$ as predicted by  the coupled Ball-Berry + FvCB model with soybean parameter values."><p class="caption">
Figure 4.4: <span class="math inline">\(g_{sw}\)</span> vs <span class="math inline">\(Q_{abs}\)</span> for several different <span class="math inline">\(h_a\)</span> as predicted by the coupled Ball-Berry + FvCB model with soybean parameter values.
</p>
</div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot An</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">Assim</span> <span class="op">~</span> <span class="va">Qabs</span>,</span>
<span>    group <span class="op">=</span> <span class="va">rh</span>,</span>
<span>    data <span class="op">=</span> <span class="va">lrc</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"Absorbed PPFD (micromol / m^2 / s)"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"Net CO2 assimilation rate (micromol / m^2 / s)"</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Ball-Berry + FvCB models for\ndifferent humidities"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:an-qabs"></span>
<img src="ball_berry_model_files/figure-html/an-qabs-1.png" alt="$A_n$ vs $Q_{abs}$ for several different $h_a$ as predicted by  the coupled Ball-Berry + FvCB model with soybean parameter values."><p class="caption">
Figure 4.5: <span class="math inline">\(A_n\)</span> vs <span class="math inline">\(Q_{abs}\)</span> for several different <span class="math inline">\(h_a\)</span> as predicted by the coupled Ball-Berry + FvCB model with soybean parameter values.
</p>
</div>
</div>
<div class="section level3" number="4.3">
<h3 id="simulated-c3-co_2-response-curves">
<span class="header-section-number">4.3</span> Simulated C3 CO<span class="math inline">\(_2\)</span> Response Curves<a class="anchor" aria-label="anchor" href="#simulated-c3-co_2-response-curves"></a>
</h3>
<p>Here we can simulate CO<span class="math inline">\(_2\)</span> response curves at different humidity levels by
coupling the Ball-Berry and Farquhar-von-Caemmerer-Berry models to an energy
balance equation. Here we will keep the ambient temperature fixed while
increasing the ambient CO<span class="math inline">\(_2\)</span> concentration, as can be done in a gas exchange
measurement system like the Licor LI-6800. The environmental conditions will
determine <span class="math inline">\(g_{sw}\)</span>, <span class="math inline">\(A_n\)</span>, <span class="math inline">\(T_l\)</span>, and <span class="math inline">\(C_i\)</span> for each value of <span class="math inline">\(C_a\)</span>, and plots
can be generated from these values. In this model, height and windspeed will
determine the boundary layer conductance; we choose a large wind speed to ensure
high conductance, as would occur in a measurement chamber.</p>
<p>From these calculations:</p>
<ul>
<li><p>We can see that <span class="math inline">\(g_{sw}\)</span> changes with <span class="math inline">\(C_i\)</span> and <span class="math inline">\(h_a\)</span> (Figure
<a href="#fig:gsw-ci">4.6</a>), but <span class="math inline">\(A_n\)</span> plotted against <span class="math inline">\(C_i\)</span> is the same for all
humidities (Figure <a href="#fig:an-ci">4.7</a>). This demonstrates that an A-Ci curve
reveals the response of photosynthesis to CO<span class="math inline">\(_2\)</span> without any influence from
the stomata. (Sometimes this idea is expressed by saying that an A-Ci curve
“peels away the epidermis.”)</p></li>
<li><p>We can also see that the value of <span class="math inline">\(C_i\)</span> corresponding to each <span class="math inline">\(C_a\)</span> does
depend on the humidity, with higher humidity corresponding to higher <span class="math inline">\(C_i\)</span>
(Figure <a href="#fig:ci-ca">4.9</a>). This relationship is mediated by the stomata, which
open more in response to higher humidity. Thus, although humidity does not
impact the shape of an A-Ci curve, it can have an effect on the range of
achievable <span class="math inline">\(C_i\)</span> values.</p></li>
<li><p>The stomatal conductance is largest when <span class="math inline">\(C_i\)</span> is near 250 ppm, and the leaf
temperature is lowest in this range (Figures <a href="#fig:gsw-ci">4.6</a> and
<a href="#fig:tl-ci">4.8</a>). This occurs because the open stomata facilitate evaporative
cooling; the cooling effect is stronger at lower humidities where the
transpiration rate is higher.</p></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set the absorbed photosynthetically active light (in micromol / m^2 / s)</span></span>
<span><span class="va">absorbed_ppfd</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co"># Determine the total absorbed light energy (in J / m^2 / s)</span></span>
<span><span class="va">absorbed_energy</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">absorbed_ppfd</span> <span class="op">*</span> <span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">par_energy_content</span> <span class="op">/</span></span>
<span>        <span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">par_energy_fraction</span></span>
<span></span>
<span><span class="va">aci</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modules.html">module_response_curve</a></span><span class="op">(</span></span>
<span>    <span class="st">'BioCro:c3_leaf_photosynthesis'</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span>, <span class="op">{</span></span>
<span>        <span class="va">StomataWS</span> <span class="op">=</span> <span class="fl">1</span> <span class="co"># dimensionless</span></span>
<span>        <span class="va">temp</span> <span class="op">=</span> <span class="fl">30</span>     <span class="co"># degrees C</span></span>
<span>        <span class="va">windspeed</span> <span class="op">=</span> <span class="fl">3</span> <span class="co"># m / s</span></span>
<span>        <span class="va">height</span> <span class="op">=</span> <span class="fl">0.8</span>  <span class="co"># m</span></span>
<span>        <span class="va">absorbed_ppfd</span> <span class="op">=</span> <span class="va">absorbed_ppfd</span></span>
<span>        <span class="va">average_absorbed_shortwave</span> <span class="op">=</span> <span class="va">absorbed_energy</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>        Catm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1800</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, <span class="co"># micromol / mol</span></span>
<span>        rh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span><span class="op">)</span>          <span class="co"># dimensionless</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the gsw-Ci curves</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">Gs</span> <span class="op">~</span> <span class="va">Ci</span>,</span>
<span>    group <span class="op">=</span> <span class="va">rh</span>,</span>
<span>    data <span class="op">=</span> <span class="va">aci</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Intercellular CO2 concentration (micromol / mol)'</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">'Stomatal conductance to H2O (mmol / m^2 / s)'</span>,</span>
<span>    main <span class="op">=</span> <span class="st">'Ball-Berry + FvCB + energy balance\nfor different humidities'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:gsw-ci"></span>
<img src="ball_berry_model_files/figure-html/gsw-ci-1.png" alt="$g_{sw}$ vs $C_i$ for several different $h_a$ as predicted by  the coupled Ball-Berry + FvCB + energy balance model with soybean parameter  values."><p class="caption">
Figure 4.6: <span class="math inline">\(g_{sw}\)</span> vs <span class="math inline">\(C_i\)</span> for several different <span class="math inline">\(h_a\)</span> as predicted by the coupled Ball-Berry + FvCB + energy balance model with soybean parameter values.
</p>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the A-Ci curves</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">Assim</span> <span class="op">~</span> <span class="va">Ci</span>,</span>
<span>    group <span class="op">=</span> <span class="va">rh</span>,</span>
<span>    data <span class="op">=</span> <span class="va">aci</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Intercellular CO2 concentration (micromol / mol)'</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">'Net CO2 assimilation rate (micromol / m^2 / s)'</span>,</span>
<span>    main <span class="op">=</span> <span class="st">'Ball-Berry + FvCB + energy balance\nfor different humidities'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:an-ci"></span>
<img src="ball_berry_model_files/figure-html/an-ci-1.png" alt="$A_n$ vs $C_i$ for several different $h_a$ as predicted by  the coupled Ball-Berry + FvCB + energy balance model with soybean parameter  values."><p class="caption">
Figure 4.7: <span class="math inline">\(A_n\)</span> vs <span class="math inline">\(C_i\)</span> for several different <span class="math inline">\(h_a\)</span> as predicted by the coupled Ball-Berry + FvCB + energy balance model with soybean parameter values.
</p>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the Tl-Ci curves</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">leaf_temperature</span> <span class="op">~</span> <span class="va">Ci</span>,</span>
<span>    group <span class="op">=</span> <span class="va">rh</span>,</span>
<span>    data <span class="op">=</span> <span class="va">aci</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Intercellular CO2 concentration (micromol / mol)'</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">'Leaf temperature (degrees C)'</span>,</span>
<span>    main <span class="op">=</span> <span class="st">'Ball-Berry + FvCB + energy balance\nfor different humidities'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:tl-ci"></span>
<img src="ball_berry_model_files/figure-html/tl-ci-1.png" alt="$T_l$ vs $C_i$ for several different $h_a$ as predicted by  the coupled Ball-Berry + FvCB + energy balance model with soybean parameter  values."><p class="caption">
Figure 4.8: <span class="math inline">\(T_l\)</span> vs <span class="math inline">\(C_i\)</span> for several different <span class="math inline">\(h_a\)</span> as predicted by the coupled Ball-Berry + FvCB + energy balance model with soybean parameter values.
</p>
</div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the Ci-Ca curves</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">Ci</span> <span class="op">~</span> <span class="va">Catm</span>,</span>
<span>    group <span class="op">=</span> <span class="va">rh</span>,</span>
<span>    data <span class="op">=</span> <span class="va">aci</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Ambient CO2 concentration (micromol / mol)'</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">'Intercellular CO2 concentration (micromol / mol)'</span>,</span>
<span>    main <span class="op">=</span> <span class="st">'Ball-Berry + FvCB + energy balance\nfor different humidities'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:ci-ca"></span>
<img src="ball_berry_model_files/figure-html/ci-ca-1.png" alt="$C_i$ vs $C_a$ for several different $h_a$ as predicted by  the coupled Ball-Berry + FvCB + energy balance model with soybean parameter  values."><p class="caption">
Figure 4.9: <span class="math inline">\(C_i\)</span> vs <span class="math inline">\(C_a\)</span> for several different <span class="math inline">\(h_a\)</span> as predicted by the coupled Ball-Berry + FvCB + energy balance model with soybean parameter values.
</p>
</div>
</div>
<div class="section level3" number="4.4">
<h3 id="gas-concentrations-within-a-c3-canopy">
<span class="header-section-number">4.4</span> Gas Concentrations Within a C3 Canopy<a class="anchor" aria-label="anchor" href="#gas-concentrations-within-a-c3-canopy"></a>
</h3>
<p>Here we can see how several quantities change throughout a soybean canopy under
a fixed set of environmental conditions when using the fully-coupled Ball-Berry
+ FvCB + energy balance model for leaf level photosynthesis. For sunlit leaves,
we observe the following trends:</p>
<ul>
<li><p>The CO<span class="math inline">\(_2\)</span> concentration at the leaf surface (<span class="math inline">\(C_s\)</span>) decreases with canopy
depth (Figure <a href="#fig:cs-layer">4.10</a>).</p></li>
<li><p>The relative humidity at the leaf surface (<span class="math inline">\(C_s\)</span>) increases with canopy depth
(Figure <a href="#fig:hs-layer">4.11</a>).</p></li>
<li><p>The stomatal conductance (<span class="math inline">\(g_{sw}\)</span>) increases with canopy depth
(Figure <a href="#fig:gsw-layer">4.12</a>).</p></li>
<li><p>The leaf temperature (<span class="math inline">\(T_l\)</span>) generally increases with canopy depth, although
the trend is not monotonic (Figure <a href="#fig:tl-layer">4.13</a>).</p></li>
<li><p>The net assimilation rate (<span class="math inline">\(A_n\)</span>) decreases with canopy depth (Figure
<a href="#fig:an-layer">4.14</a>).</p></li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run canopy modules</span></span>
<span><span class="va">RH_a</span> <span class="op">&lt;-</span> <span class="fl">0.8</span>     <span class="co"># dimensionless; ambient relative humidity</span></span>
<span><span class="va">T_ambient</span> <span class="op">&lt;-</span> <span class="fl">30</span> <span class="co"># degrees C; ambient air temperature</span></span>
<span><span class="va">StomataWS</span> <span class="op">&lt;-</span> <span class="fl">1</span>  <span class="co"># no water stress</span></span>
<span></span>
<span><span class="va">canres</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_biocro.html">run_biocro</a></span><span class="op">(</span></span>
<span>    direct_module_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">'BioCro:solar_position_michalsky'</span>,</span>
<span>        <span class="st">'BioCro:shortwave_atmospheric_scattering'</span>,</span>
<span>        <span class="st">'BioCro:incident_shortwave_from_ground_par'</span>,</span>
<span>        <span class="st">'BioCro:ten_layer_canopy_properties'</span>,</span>
<span>        <span class="st">'BioCro:ten_layer_c3_canopy'</span></span>
<span>    <span class="op">)</span>,</span>
<span>    parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span>, <span class="op">{</span></span>
<span>        <span class="va">year</span> <span class="op">=</span> <span class="fl">2022</span></span>
<span>        <span class="va">time_zone_offset</span> <span class="op">=</span> <span class="op">-</span><span class="fl">6</span> <span class="co"># CDT</span></span>
<span>        <span class="va">solar</span> <span class="op">=</span> <span class="fl">1500</span>          <span class="co"># micromol / m^2 / s</span></span>
<span>        <span class="va">lai</span> <span class="op">=</span> <span class="fl">3</span>               <span class="co"># dimensionless</span></span>
<span>        <span class="va">rh</span> <span class="op">=</span> <span class="va">RH_a</span>             <span class="co"># dimensionless</span></span>
<span>        <span class="va">windspeed</span> <span class="op">=</span> <span class="fl">2</span>         <span class="co"># m / s</span></span>
<span>        <span class="va">temp</span> <span class="op">=</span> <span class="va">T_ambient</span>      <span class="co"># degrees C</span></span>
<span>        <span class="va">StomataWS</span> <span class="op">=</span> <span class="va">StomataWS</span> <span class="co"># dimensionless</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>    drivers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fl">210.5</span><span class="op">)</span> <span class="co"># noon on day 210 (July 29 for 2022)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract canopy profiles</span></span>
<span><span class="va">canopy_profiles_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'sunlit'</span>, <span class="st">'shaded'</span><span class="op">)</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">leaf_class</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">cs_column_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">leaf_class</span>, <span class="st">'_Cs_layer_[0-9]'</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">canres</span><span class="op">)</span>,</span>
<span>            value <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span>        <span class="va">rhs_column_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">leaf_class</span>, <span class="st">'_RHs_layer_[0-9]'</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">canres</span><span class="op">)</span>,</span>
<span>            value <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span>        <span class="va">gsw_column_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">leaf_class</span>, <span class="st">'_Gs_layer_[0-9]'</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">canres</span><span class="op">)</span>,</span>
<span>            value <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span>        <span class="va">tl_column_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">leaf_class</span>, <span class="st">'_leaf_temperature_layer_[0-9]'</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">canres</span><span class="op">)</span>,</span>
<span>            value <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span>        <span class="va">a_column_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">leaf_class</span>, <span class="st">'_Assim_layer_[0-9]'</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">canres</span><span class="op">)</span>,</span>
<span>            value <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>            type <span class="op">=</span> <span class="va">leaf_class</span>,</span>
<span>            layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>            Cs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">canres</span><span class="op">[</span><span class="va">cs_column_names</span><span class="op">]</span><span class="op">)</span>,</span>
<span>            RHs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">canres</span><span class="op">[</span><span class="va">rhs_column_names</span><span class="op">]</span><span class="op">)</span>,</span>
<span>            gsw <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">canres</span><span class="op">[</span><span class="va">gsw_column_names</span><span class="op">]</span><span class="op">)</span>,</span>
<span>            tl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">canres</span><span class="op">[</span><span class="va">tl_column_names</span><span class="op">]</span><span class="op">)</span>,</span>
<span>            A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">canres</span><span class="op">[</span><span class="va">a_column_names</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">canopy_profiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">canopy_profiles_list</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the Cs profiles</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">Cs</span> <span class="op">~</span> <span class="va">layer</span>,</span>
<span>    group <span class="op">=</span> <span class="va">type</span>,</span>
<span>    data <span class="op">=</span> <span class="va">canopy_profiles</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Canopy layer (0 is top, 9 is bottom)'</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">'CO2 concentration at leaf surface (micromol / mol)'</span>,</span>
<span>    main <span class="op">=</span> <span class="st">'Ball-Berry + FvCB + energy balance\nwithin a soybean canopy'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:cs-layer"></span>
<img src="ball_berry_model_files/figure-html/cs-layer-1.png" alt="$C_s$ vs canopy layer for sunlit and shaded leaves as predicted by  the coupled Ball-Berry + FvCB + energy balance model with soybean parameter  values."><p class="caption">
Figure 4.10: <span class="math inline">\(C_s\)</span> vs canopy layer for sunlit and shaded leaves as predicted by the coupled Ball-Berry + FvCB + energy balance model with soybean parameter values.
</p>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the RHs profiles</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">RHs</span> <span class="op">~</span> <span class="va">layer</span>,</span>
<span>    group <span class="op">=</span> <span class="va">type</span>,</span>
<span>    data <span class="op">=</span> <span class="va">canopy_profiles</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Canopy layer (0 is top, 9 is bottom)'</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">'Relative humidity at leaf surface (micromol / mol)'</span>,</span>
<span>    main <span class="op">=</span> <span class="st">'Ball-Berry + FvCB + energy balance\nwithin a soybean canopy'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:hs-layer"></span>
<img src="ball_berry_model_files/figure-html/hs-layer-1.png" alt="$h_s$ vs canopy layer for sunlit and shaded leaves as predicted by  the coupled Ball-Berry + FvCB + energy balance model with soybean parameter  values."><p class="caption">
Figure 4.11: <span class="math inline">\(h_s\)</span> vs canopy layer for sunlit and shaded leaves as predicted by the coupled Ball-Berry + FvCB + energy balance model with soybean parameter values.
</p>
</div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the gsw profiles</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">gsw</span> <span class="op">~</span> <span class="va">layer</span>,</span>
<span>    group <span class="op">=</span> <span class="va">type</span>,</span>
<span>    data <span class="op">=</span> <span class="va">canopy_profiles</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Canopy layer (0 is top, 9 is bottom)'</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">'Stomatal conductance to H2O (mmol / m^2 / s)'</span>,</span>
<span>    main <span class="op">=</span> <span class="st">'Ball-Berry + FvCB + energy balance\nwithin a soybean canopy'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:gsw-layer"></span>
<img src="ball_berry_model_files/figure-html/gsw-layer-1.png" alt="$g_{sw}$ vs canopy layer for sunlit and shaded leaves as predicted  by the coupled Ball-Berry + FvCB + energy balance model with soybean  parameter values."><p class="caption">
Figure 4.12: <span class="math inline">\(g_{sw}\)</span> vs canopy layer for sunlit and shaded leaves as predicted by the coupled Ball-Berry + FvCB + energy balance model with soybean parameter values.
</p>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the leaf temperature profiles</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">tl</span> <span class="op">~</span> <span class="va">layer</span>,</span>
<span>    group <span class="op">=</span> <span class="va">type</span>,</span>
<span>    data <span class="op">=</span> <span class="va">canopy_profiles</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Canopy layer (0 is top, 9 is bottom)'</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">'Leaf temperature (degrees C)'</span>,</span>
<span>    main <span class="op">=</span> <span class="st">'Ball-Berry + FvCB + energy balance\nwithin a soybean canopy'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:tl-layer"></span>
<img src="ball_berry_model_files/figure-html/tl-layer-1.png" alt="$T_l$ vs canopy layer for sunlit and shaded leaves as predicted by  the coupled Ball-Berry + FvCB + energy balance model with soybean parameter  values."><p class="caption">
Figure 4.13: <span class="math inline">\(T_l\)</span> vs canopy layer for sunlit and shaded leaves as predicted by the coupled Ball-Berry + FvCB + energy balance model with soybean parameter values.
</p>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the assimilation profiles</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">A</span> <span class="op">~</span> <span class="va">layer</span>,</span>
<span>    group <span class="op">=</span> <span class="va">type</span>,</span>
<span>    data <span class="op">=</span> <span class="va">canopy_profiles</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Canopy layer (0 is top, 9 is bottom)'</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">'Net CO2 assimilation rate (micromol / m^2 / s)'</span>,</span>
<span>    main <span class="op">=</span> <span class="st">'Ball-Berry + FvCB + energy balance\nwithin a soybean canopy'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:an-layer"></span>
<img src="ball_berry_model_files/figure-html/an-layer-1.png" alt="$A_n$ vs canopy layer for sunlit and shaded leaves as predicted by  the coupled Ball-Berry + FvCB + energy balance model with soybean parameter  values."><p class="caption">
Figure 4.14: <span class="math inline">\(A_n\)</span> vs canopy layer for sunlit and shaded leaves as predicted by the coupled Ball-Berry + FvCB + energy balance model with soybean parameter values.
</p>
</div>
</div>
<div class="section level3" number="4.5">
<h3 id="soybean-modeling">
<span class="header-section-number">4.5</span> Soybean Modeling<a class="anchor" aria-label="anchor" href="#soybean-modeling"></a>
</h3>
<p>Here we can see how the Ball-Berry slope can affect soybean yield. The slope
encapsulates the “willingness” of a crop to open its stomata. When resources are
plentiful, higher stomatal conductance may allow for more carbon assimilation
and hence growth. On the other hand, higher stomatal conductance increases water
losses due to transpiration, and can exacerbate drought stress. Thus, the exact
impact of a change in <span class="math inline">\(b_1\)</span> will therefore strongly depend on the particular
location and weather.</p>
<p>In BioCro, the soil water content determines the water stress level in the
plant, reducing the Ball-Berry parameters during times of low water
availability. At the same time, canopy transpiration influences the soil water
content, with higher transpiration rates causing a faster depletion of soil
water. In this example, we will just use weather data from 2002 in Champaign,
Illinois; under these conditions, increasing the Ball-Berry slope causes the
final seed mass (called <code>Grain</code> here) to increase (Figure
<a href="#fig:biomass-slope">4.15</a>).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use partial application to create a function that runs a soybean simulation</span></span>
<span><span class="co"># for a given value of the Ball-Berry slope</span></span>
<span><span class="va">bb1_func</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">soybean</span>, <span class="op">{</span><span class="fu"><a href="../reference/partial_application.html">partial_run_biocro</a></span><span class="op">(</span></span>
<span>    <span class="va">initial_values</span>,</span>
<span>    <span class="va">parameters</span>,</span>
<span>    <span class="va">soybean_weather</span><span class="op">[[</span><span class="st">'2002'</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    <span class="va">direct_modules</span>,</span>
<span>    <span class="va">differential_modules</span>,</span>
<span>    <span class="va">ode_solver</span>,</span>
<span>    <span class="st">'b1'</span> <span class="co"># the name of the parameter we wish to vary</span></span>
<span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the soybean model for several different slope values</span></span>
<span><span class="va">bb1_result_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">b1</span> <span class="op">-</span> <span class="fl">3</span>, <span class="va">soybean</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">b1</span> <span class="op">+</span> <span class="fl">3</span>, by <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="fu">bb1_func</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="op">{</span><span class="va">b1</span> <span class="op">=</span> <span class="va">x</span><span class="op">}</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Collect the results into a single data frame</span></span>
<span><span class="va">bb1_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">bb1_result_list</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot soybean biomass values for different values of the Ball-Berry slope</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>    <span class="va">Leaf</span> <span class="op">+</span> <span class="va">Stem</span> <span class="op">+</span> <span class="va">Root</span> <span class="op">+</span> <span class="va">Grain</span> <span class="op">~</span> <span class="va">time</span>,</span>
<span>    group <span class="op">=</span> <span class="va">b1</span>,</span>
<span>    data <span class="op">=</span> <span class="va">bb1_result</span>,</span>
<span>    type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span>    auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'Day of year (2002)'</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">'Biomass (Mg / ha)'</span>,</span>
<span>    main <span class="op">=</span> <span class="st">'Testing different soybean Ball-Berry slope values'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:biomass-slope"></span>
<img src="ball_berry_model_files/figure-html/biomass-slope-1.png" alt="Soybean biomass values predicted for Champaign, Illinois during  2002 using different values of the Ball-Berry slope $b_1$."><p class="caption">
Figure 4.15: Soybean biomass values predicted for Champaign, Illinois during 2002 using different values of the Ball-Berry slope <span class="math inline">\(b_1\)</span>.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-ball_model_1987" class="csl-entry">
Ball, J. Timothy, Ian E. Woodrow, and Joseph A. Berry. 1987. <span>“A <span>Model</span> <span>Predicting</span> <span>Stomatal</span> <span>Conductance</span> and Its <span>Contribution</span> to the <span>Control</span> of <span>Photosynthesis</span> Under <span>Different</span> <span>Environmental</span> <span>Conditions</span>.”</span> In <em>Progress in <span>Photosynthesis</span> <span>Research</span>: <span>Volume</span> 4 <span>Proceedings</span> of the <span>VIIth</span> <span>International</span> <span>Congress</span> on <span>Photosynthesis</span> <span>Providence</span>, <span>Rhode</span> <span>Island</span>, <span>USA</span>, <span>August</span> 10–15, 1986</em>, edited by J. Biggins, 221–24. Dordrecht: Springer Netherlands. <a href="https://doi.org/10.1007/978-94-017-0519-6_48" class="external-link">https://doi.org/10.1007/978-94-017-0519-6_48</a>.
</div>
<div id="ref-von_caemmerer_relationships_1981" class="csl-entry">
Caemmerer, S. von, and G. D. Farquhar. 1981. <span>“Some Relationships Between the Biochemistry of Photosynthesis and the Gas Exchange of Leaves.”</span> <em>Planta</em> 153 (4): 376–87. <a href="https://doi.org/10.1007/BF00384257" class="external-link">https://doi.org/10.1007/BF00384257</a>.
</div>
<div id="ref-dewar_ballberryleuning_2002" class="csl-entry">
Dewar, R. C. 2002. <span>“The <span>Ball</span>–<span>Berry</span>–<span>Leuning</span> and <span>Tardieu</span>–<span>Davies</span> Stomatal Models: Synthesis and Extension Within a Spatially Aggregated Picture of Guard Cell Function.”</span> <em>Plant, Cell &amp; Environment</em> 25 (11): 1383–98. <a href="https://doi.org/10.1046/j.1365-3040.2002.00909.x" class="external-link">https://doi.org/10.1046/j.1365-3040.2002.00909.x</a>.
</div>
<div id="ref-leuning_critical_1995" class="csl-entry">
Leuning, R. 1995. <span>“A Critical Appraisal of a Combined Stomatal-Photosynthesis Model for <span>C3</span> Plants.”</span> <em>Plant, Cell &amp; Environment</em> 18 (4): 339–55. <a href="https://doi.org/10.1111/j.1365-3040.1995.tb00370.x" class="external-link">https://doi.org/10.1111/j.1365-3040.1995.tb00370.x</a>.
</div>
<div id="ref-tardieu_integration_1993" class="csl-entry">
Tardieu, F., and W. J. Davies. 1993. <span>“Integration of Hydraulic and Chemical Signalling in the Control of Stomatal Conductance and Water Status of Droughted Plants.”</span> <em>Plant, Cell &amp; Environment</em> 16 (4): 341–49. <a href="https://doi.org/10.1111/j.1365-3040.1993.tb00880.x" class="external-link">https://doi.org/10.1111/j.1365-3040.1993.tb00880.x</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Justin M. McGrath, Edward B. Lochocki, Scott Rohde, Deepak Jaiswal, Megan L. Matthews, Fernando E. Miguez, Stephen P. Long.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
